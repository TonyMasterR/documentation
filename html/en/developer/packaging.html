<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Packaging Third-Party Code &mdash; Sage Developer&#39;s Guide v7.1</title>
    
    <link rel="stylesheet" href="_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '7.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Sage Developer&#39;s Guide v7.1" href="index.html" />
    <link rel="next" title="Packaging Old-Style SPKGs" href="packaging_old_spkgs.html" />
    <link rel="prev" title="Using External Libraries and Interfaces" href="coding_in_other.html" />
    <link rel="icon" href="_static/sageicon.png" type="image/x-icon" />

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="packaging_old_spkgs.html" title="Packaging Old-Style SPKGs"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="coding_in_other.html" title="Using External Libraries and Interfaces"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v7.1</a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="packaging-third-party-code">
<span id="chapter-packaging"></span><h1>Packaging Third-Party Code<a class="headerlink" href="#packaging-third-party-code" title="Permalink to this headline">¶</a></h1>
<p>One of the mottoes of the Sage project is to not reinvent the wheel: If
an algorithm is already implemented in a well-tested library then
consider incorporating that library into Sage. The current list of
available packages are the subdirectories of <tt class="docutils literal"><span class="pre">SAGE_ROOT/build/pkgs/</span></tt>.
The installation of packages is done through a bash script located in
<tt class="docutils literal"><span class="pre">SAGE_ROOT/build/bin/sage-spkg</span></tt>. This script is typically invoked by
giving the command:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[user@localhost]$ sage -i &lt;options&gt; &lt;package name&gt;...
</pre></div>
</div>
<p>options can be:</p>
<ul class="simple">
<li>-f: install a package even if the same version is already installed</li>
<li>-s: do not delete temporary build directory</li>
<li>-c: after installing, run the test suite for the spkg. This should
override the settings of <tt class="docutils literal"><span class="pre">SAGE_CHECK</span></tt> and <tt class="docutils literal"><span class="pre">SAGE_CHECK_PACKAGES</span></tt>.</li>
<li>-d: only download the package</li>
</ul>
<p>The section <a class="reference internal" href="#section-directory-structure"><em>Directory Structure</em></a> describes the structure
of each individual package in <tt class="docutils literal"><span class="pre">SAGE_ROOT/build/pkgs</span></tt>. In section
<a class="reference internal" href="#section-manual-build"><em>Building the package</em></a> we see how you can install and test a new
spkg that you or someone else wrote. Finally,
<a class="reference internal" href="#section-inclusion-procedure"><em>Inclusion Procedure for New and Updated Packages</em></a> explains how to submit a new package
for inclusion in the Sage source code.</p>
<div class="section" id="package-types">
<span id="section-package-types"></span><h2>Package types<a class="headerlink" href="#package-types" title="Permalink to this headline">¶</a></h2>
<p>Not all packages are built by default, they are divided into standard,
optional and experimental ones:</p>
<ul class="simple">
<li><strong>standard</strong> packages are built by default. For a few packages,
<tt class="docutils literal"><span class="pre">configure</span></tt> checks whether they are available from the system,
in which case the build of those packages is skipped.
Standard packages have stringent quality requirements:
they should work on all supported platforms. In order
for a new standard package to be accepted, it should have been
optional for a while, see <a class="reference internal" href="#section-inclusion-procedure"><em>Inclusion Procedure for New and Updated Packages</em></a>.</li>
<li><strong>optional</strong> packages are subject to the same requirements, they
should also work on all supported platforms. If there are
<a class="reference internal" href="doctesting.html#section-optional-doctest-flag"><em>optional doctests</em></a> in the Sage
library, those tests must pass.
Note that optional packages are not tested as much as standard
packages, so in practice they might break more often than standard
packages.</li>
<li>for <strong>experimental</strong> packages, the bar is much lower: even if there are
some problems, the package can still be accepted.</li>
</ul>
</div>
<div class="section" id="directory-structure">
<span id="section-directory-structure"></span><h2>Directory Structure<a class="headerlink" href="#directory-structure" title="Permalink to this headline">¶</a></h2>
<p>Third-party packages in Sage consists of two parts:</p>
<ol class="arabic simple">
<li>The tarball as it is distributed by the third party, or as close as
possible. Valid reasons for modifying the tarball are deleting
unnecessary files to keep the download size manageable,
regenerating auto-generated files or changing the directory structure
if necessary. In certain cases, you may need to (additionally) change
the filename of the tarball.
In any case, the actual code must be unmodified: if you need to
change the sources, add a <a class="reference internal" href="#section-spkg-patching"><em>patch</em></a>
instead. See also <a class="reference internal" href="#section-spkg-src"><em>Modified Tarballs</em></a> for automating the
modifications to the upstream tarball.</li>
<li>The build scripts and associated files are in a subdirectory
<tt class="docutils literal"><span class="pre">SAGE_ROOT/build/pkgs/&lt;package&gt;</span></tt>, where you replace <tt class="docutils literal"><span class="pre">&lt;package&gt;</span></tt>
with a lower-case version of the upstream project name. If the
project name contains characters which are not alphanumeric
and are not an underscore, those characters should be removed
or replaced by an underscore. For example, the project
<tt class="docutils literal"><span class="pre">FFLAS-FFPACK</span></tt> is called <tt class="docutils literal"><span class="pre">fflas_ffpack</span></tt> in Sage and <tt class="docutils literal"><span class="pre">path.py</span></tt>
is renamed <tt class="docutils literal"><span class="pre">pathpy</span></tt> in Sage.</li>
</ol>
<p>As an example, let us consider a hypothetical FoO project. They
(upstream) distribute a tarball <tt class="docutils literal"><span class="pre">FoO-1.3.tar.gz</span></tt> (that will be
automatically placed in <tt class="docutils literal"><span class="pre">SAGE_ROOT/upstream</span></tt> during the installation
process). To package it in Sage, we create a subdirectory containing as
a minimum the following files:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>SAGE_ROOT/build/pkgs/foo
|-- checksums.ini
|-- dependencies
|-- package-version.txt
|-- spkg-install
|-- SPKG.txt
`-- type
</pre></div>
</div>
<p>The following are some additional files which can be added:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>SAGE_ROOT/build/pkgs/foo
|-- patches
|   |-- bar.patch
|   `-- baz.patch
|-- spkg-check
`-- spkg-src
</pre></div>
</div>
<p>We discuss the individual files in the following sections.</p>
<div class="section" id="package-type">
<h3>Package type<a class="headerlink" href="#package-type" title="Permalink to this headline">¶</a></h3>
<p>The file <tt class="docutils literal"><span class="pre">type</span></tt> should contain a single word, which is either
<tt class="docutils literal"><span class="pre">standard</span></tt>, <tt class="docutils literal"><span class="pre">optional</span></tt> or <tt class="docutils literal"><span class="pre">experimental</span></tt>.
See <a class="reference internal" href="#section-package-types"><em>Package types</em></a> for the meaning of these types.</p>
</div>
<div class="section" id="install-script">
<span id="section-spkg-install"></span><h3>Install Script<a class="headerlink" href="#install-script" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">spkg-install</span></tt> file is a shell script or Python script which
installs the package.
In the best case, the upstream project can simply be installed by the
usual configure / make / make install steps. In that case, the build
script would simply consist of:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>#!/usr/bin/env bash

cd src

./configure --prefix=&quot;$SAGE_LOCAL&quot; --libdir=&quot;$SAGE_LOCAL/lib&quot;
if [ $? -ne 0 ]; then
    echo &gt;&amp;2 &quot;Error configuring PACKAGE_NAME.&quot;
    exit 1
fi

$MAKE
if [ $? -ne 0 ]; then
    echo &gt;&amp;2 &quot;Error building PACKAGE_NAME.&quot;
    exit 1
fi

$MAKE install
if [ $? -ne 0 ]; then
    echo &gt;&amp;2 &quot;Error installing PACKAGE_NAME.&quot;
    exit 1
fi
</pre></div>
</div>
<p>Note that the top-level directory inside the tarball is renamed to
<tt class="docutils literal"><span class="pre">src</span></tt> before calling the <tt class="docutils literal"><span class="pre">spkg-install</span></tt> script, so you can just use
<tt class="docutils literal"><span class="pre">cd</span> <span class="pre">src</span></tt> instead of <tt class="docutils literal"><span class="pre">cd</span> <span class="pre">foo-1.3</span></tt>.</p>
<p>If there is any meaningful documentation included but not installed by
<tt class="docutils literal"><span class="pre">make</span> <span class="pre">install</span></tt>, then you can add something like the following to
install it:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>if [ &quot;$SAGE_SPKG_INSTALL_DOCS&quot; = yes ] ; then
    $MAKE doc
    if [ $? -ne 0 ]; then
        echo &gt;&amp;2 &quot;Error building PACKAGE_NAME docs.&quot;
        exit 1
    fi
    mkdir -p &quot;$SAGE_LOCAL/share/doc/PACKAGE_NAME&quot;
    cp -R doc/* &quot;$SAGE_ROOT/local/share/doc/PACKAGE_NAME&quot;
fi
</pre></div>
</div>
</div>
<div class="section" id="self-tests">
<span id="section-spkg-check"></span><h3>Self-Tests<a class="headerlink" href="#self-tests" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">spkg-check</span></tt> file is an optional, but highly recommended, script
to run self-tests of the package. It is run after building and
installing if the <tt class="docutils literal"><span class="pre">SAGE_CHECK</span></tt> environment variable is set, see the
Sage installation guide. Ideally, upstream has some sort of tests suite
that can be run with the standard <tt class="docutils literal"><span class="pre">make</span> <span class="pre">check</span></tt> target. In that case,
the <tt class="docutils literal"><span class="pre">spkg-check</span></tt> script would simply contain:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>#!/usr/bin/env bash

cd src
$MAKE check
</pre></div>
</div>
</div>
<div class="section" id="the-spkg-txt-file">
<span id="section-spkg-spkg-txt"></span><h3>The SPKG.txt File<a class="headerlink" href="#the-spkg-txt-file" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">SPKG.txt</span></tt> file should follow this pattern:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>= PACKAGE_NAME =

== Description ==

What does the package do?

== License ==

What is the license? If non-standard, is it GPLv3+ compatible?

== Upstream Contact ==

Provide information for upstream contact.

== Dependencies ==

Put a bulleted list of dependencies here:

* python
* readline

== Special Update/Build Instructions ==

If the tarball was modified by hand and not via a spkg-src
script, describe what was changed.
</pre></div>
</div>
<p>with <tt class="docutils literal"><span class="pre">PACKAGE_NAME</span></tt> replaced by the the package name. Legacy
<tt class="docutils literal"><span class="pre">SPKG.txt</span></tt> files have an additional changelog section, but this
information is now kept in the git repository.</p>
</div>
<div class="section" id="package-dependencies">
<span id="section-dependencies"></span><h3>Package dependencies<a class="headerlink" href="#package-dependencies" title="Permalink to this headline">¶</a></h3>
<p>Many packages depend on other packages. Consider for example the
<tt class="docutils literal"><span class="pre">eclib</span></tt> package for elliptic curves. This package uses the libraries
PARI, NTL and FLINT. So the following is the <tt class="docutils literal"><span class="pre">dependencies</span></tt> file
for <tt class="docutils literal"><span class="pre">eclib</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>pari ntl flint

----------
All lines of this file are ignored except the first.
It is copied by SAGE_ROOT/build/make/install into SAGE_ROOT/build/make/Makefile.
</pre></div>
</div>
<p>If there are no dependencies, you can use</p>
<div class="highlight-python"><div class="highlight"><pre><span></span># no dependencies

----------
All lines of this file are ignored except the first.
It is copied by SAGE_ROOT/build/make/install into SAGE_ROOT/build/make/Makefile.
</pre></div>
</div>
<p>There are actually two kinds of dependencies: there are normal
dependencies and order-only dependencies, which are weaker. The syntax
for the <tt class="docutils literal"><span class="pre">dependencies</span></tt> file is</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>normal dependencies | order-only dependencies
</pre></div>
</div>
<p>If there is no <tt class="docutils literal"><span class="pre">|</span></tt>, then all dependencies are normal.</p>
<ul class="simple">
<li>If package A has an <strong>order-only dependency</strong> on B, it simply means
that B must be built before A can be built. The version of B does not
matter, only the fact that B is installed matters.
This should be used if the dependency is purely a build-time
dependency (for example, a dependency on Python simply because the
<tt class="docutils literal"><span class="pre">spkg-install</span></tt> file is written in Python).</li>
<li>If A has a <strong>normal dependency</strong> on B, it means additionally that A
should be rebuilt every time that B gets updated. This is the most
common kind of dependency. A normal dependency is what you need for
libraries: if we upgrade NTL, we should rebuild everything which
uses NTL.</li>
</ul>
<p>In order to check that the dependencies of your package are likely
correct, the following command should work without errors:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[user@localhost]$ make distclean &amp;&amp; make base &amp;&amp; make PACKAGE_NAME
</pre></div>
</div>
<p>Finally, note that standard packages should only depend on standard
packages and optional packages should only depend on standard or
optional packages.</p>
</div>
<div class="section" id="patching-sources">
<span id="section-spkg-patching"></span><h3>Patching Sources<a class="headerlink" href="#patching-sources" title="Permalink to this headline">¶</a></h3>
<p>Actual changes to the source code must be via patches, which should be
placed in the <tt class="docutils literal"><span class="pre">patches</span></tt> directory. GNU patch is distributed with
Sage, so you can rely on it being available. Patches must include
documentation in their header (before the first diff hunk), so a
typical patch file should look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Add autodoc_builtin_argspec config option

Following the title line you can add a multi-line description of
what the patch does, where you got it from if you did not write it
yourself, if they are platform specific, if they should be pushed
upstream, etc...

diff -dru Sphinx-1.2.2/sphinx/ext/autodoc.py.orig Sphinx-1.2.2/sphinx/ext/autodoc.py
--- Sphinx-1.2.2/sphinx/ext/autodoc.py.orig  2014-03-02 20:38:09.000000000 +1300
+++ Sphinx-1.2.2/sphinx/ext/autodoc.py  2014-10-19 23:02:09.000000000 +1300
@@ -1452,6 +1462,7 @@

     app.add_config_value(&#39;autoclass_content&#39;, &#39;class&#39;, True)
     app.add_config_value(&#39;autodoc_member_order&#39;, &#39;alphabetic&#39;, True)
+    app.add_config_value(&#39;autodoc_builtin_argspec&#39;, None, True)
     app.add_config_value(&#39;autodoc_default_flags&#39;, [], True)
     app.add_config_value(&#39;autodoc_docstring_signature&#39;, True, True)
     app.add_event(&#39;autodoc-process-docstring&#39;)
</pre></div>
</div>
<p>Patches to files in <tt class="docutils literal"><span class="pre">src/</span></tt> need to be applied in <tt class="docutils literal"><span class="pre">spkg-install</span></tt>,
that is, if there are any patches then your <tt class="docutils literal"><span class="pre">spkg-install</span></tt> script
should contain a section like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>for patch in ../patches/*.patch; do
    [ -r &quot;$patch&quot; ] || continue  # Skip non-existing or non-readable patches
    patch -p1 &lt;&quot;$patch&quot;
    if [ $? -ne 0 ]; then
        echo &gt;&amp;2 &quot;Error applying &#39;$patch&#39;&quot;
        exit 1
    fi
done
</pre></div>
</div>
<p>which applies the patches to the sources.</p>
</div>
<div class="section" id="modified-tarballs">
<span id="section-spkg-src"></span><h3>Modified Tarballs<a class="headerlink" href="#modified-tarballs" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">spkg-src</span></tt> file is optional and only to document how the upstream
tarball was changed. Ideally it is not modified, then there would be no
<tt class="docutils literal"><span class="pre">spkg-src</span></tt> file present either.</p>
<p>However, if you really must modify the upstream tarball then it is
recommended that you write a script, called <tt class="docutils literal"><span class="pre">spkg-src</span></tt>, that makes the
changes. This not only serves as documentation but also makes it easier
to apply the same modifications to future versions.</p>
</div>
<div class="section" id="package-versioning">
<span id="section-spkg-versioning"></span><h3>Package Versioning<a class="headerlink" href="#package-versioning" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">package-version.txt</span></tt> file containts just the version. So if
upstream is <tt class="docutils literal"><span class="pre">FoO-1.3.tar.gz</span></tt> then the package version file would only
contain <tt class="docutils literal"><span class="pre">1.3</span></tt>.</p>
<p>If the upstream package is taken from some revision other than a stable
version or if upstream doesn&#8217;t have a version number, you should use the
date at which the revision is made. For example, the
<tt class="docutils literal"><span class="pre">database_stein_watkins</span></tt> package with version <tt class="docutils literal"><span class="pre">20110713</span></tt> contains
the database as of 2011-07-13. Note that the date should refer to the
<em>contents</em> of the tarball, not to the day it was packaged for Sage.
This particular Sage package for <tt class="docutils literal"><span class="pre">database_stein_watkins</span></tt> was created
in 2014, but the data it contains was last updated in 2011.</p>
<p>If you apply any patches, or if you made changes to the upstream tarball
(see <a class="reference internal" href="#section-directory-structure"><em>Directory Structure</em></a> for allowable changes),
then you should append a <tt class="docutils literal"><span class="pre">.p0</span></tt> to the version to indicate that it&#8217;s
not a vanilla package.</p>
<p>Additionally, whenever you make changes to a package <em>without</em> changing
the upstream tarball (for example, you add an additional patch or you
fix something in the <tt class="docutils literal"><span class="pre">spkg-install</span></tt> file), you should also add or
increase the patch level. So the different versions would
be <tt class="docutils literal"><span class="pre">1.3</span></tt>, <tt class="docutils literal"><span class="pre">1.3.p0</span></tt>, <tt class="docutils literal"><span class="pre">1.3.p1</span></tt>, ...
The change in version number or patch level will trigger
re-installation of the package, such that the changes are taken into
account.</p>
</div>
<div class="section" id="checksums">
<span id="section-spkg-checksums"></span><h3>Checksums<a class="headerlink" href="#checksums" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">checksums.ini</span></tt> file contains checksums of the upstream tarball.
It is autogenerated, so you just have to place the upstream tarball in
the <tt class="docutils literal"><span class="pre">SAGE_ROOT/upstream/</span></tt> directory and run:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[user@localhost]$ sage --fix-pkg-checksums
</pre></div>
</div>
</div>
</div>
<div class="section" id="building-the-package">
<span id="section-manual-build"></span><h2>Building the package<a class="headerlink" href="#building-the-package" title="Permalink to this headline">¶</a></h2>
<p>At this stage you have a new tarball that is not yet distributed with
Sage (<tt class="docutils literal"><span class="pre">FoO-1.3.tar.gz</span></tt> in the example of section
<a class="reference internal" href="#section-directory-structure"><em>Directory Structure</em></a>). Now you need to manually place it
in the <tt class="docutils literal"><span class="pre">SAGE_ROOT/upstream/</span></tt> directory and run
<tt class="docutils literal"><span class="pre">sage</span> <span class="pre">--fix-pkg-checksums</span></tt> if you have not done that yet.</p>
<p>Now you can install the package using:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[user@localhost]$ sage -i package_name
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[user@localhost]$ sage -f package_name
</pre></div>
</div>
<p>to force a reinstallation. If your package contains a <tt class="docutils literal"><span class="pre">spkg-check</span></tt>
script (see <a class="reference internal" href="#section-spkg-check"><em>Self-Tests</em></a>) it can be run with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[user@localhost]$ sage -i -c package_name
</pre></div>
</div>
<p>or:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>[user@localhost]$ sage -f -c package_name
</pre></div>
</div>
<p>If all went fine, open a ticket, put a link to the original tarball in
the ticket and upload a branch with the code under
<tt class="docutils literal"><span class="pre">SAGE_ROOT/build/pkgs</span></tt>.</p>
</div>
<div class="section" id="inclusion-procedure-for-new-and-updated-packages">
<span id="section-inclusion-procedure"></span><h2>Inclusion Procedure for New and Updated Packages<a class="headerlink" href="#inclusion-procedure-for-new-and-updated-packages" title="Permalink to this headline">¶</a></h2>
<p>Packages that are not part of Sage will first become optional or
experimental (the latter if they will not build on all supported
systems). After they have been in optional for some time without
problems they can be proposed to be included as standard packages in
Sage.</p>
<p>To propose a package for optional/experimental inclusion please open a
trac ticket with the respective <tt class="docutils literal"><span class="pre">Component:</span></tt> field set to either
<tt class="docutils literal"><span class="pre">packages:experimental</span></tt> or <tt class="docutils literal"><span class="pre">packages:optional</span></tt>. The associated code
requirements are described in the following sections.</p>
<p>After the ticket was reviewed and included, optional packages stay in
that status for at least a year, after which they can be proposed to be
included as standard packages in Sage. For this a trac ticket is opened
with the <tt class="docutils literal"><span class="pre">Component:</span></tt> field set to <tt class="docutils literal"><span class="pre">packages:standard</span></tt>. Then make
a proposal in the Google Group <tt class="docutils literal"><span class="pre">sage-devel</span></tt>.</p>
<p>Upgrading packages to new upstream versions or with additional patches
includes opening a ticket in the respective category too, as described
above.</p>
<div class="section" id="license-information">
<h3>License Information<a class="headerlink" href="#license-information" title="Permalink to this headline">¶</a></h3>
<p>If you are patching a standard Sage spkg, then you should make sure that
the license information for that package is up-to-date, both in its
<tt class="docutils literal"><span class="pre">SPKG.txt</span></tt> file and in the file <tt class="docutils literal"><span class="pre">SAGE_ROOT/COPYING.txt</span></tt>.  For
example, if you are producing an spkg which upgrades the vanilla source
to a new version, check whether the license changed between versions.</p>
</div>
<div class="section" id="prerequisites-for-new-standard-packages">
<h3>Prerequisites for New Standard Packages<a class="headerlink" href="#prerequisites-for-new-standard-packages" title="Permalink to this headline">¶</a></h3>
<p>For a package to become part of Sage&#8217;s standard distribution, it
must meet the following requirements:</p>
<ul>
<li><p class="first"><strong>License</strong>. For standard packages, the license must be compatible
with the GNU General Public License, version 3. The Free Software
Foundation maintains a long list of <a class="reference external" href="http://www.gnu.org/licenses/license-list.html">licenses and comments about
them</a>.</p>
</li>
<li><p class="first"><strong>Build Support</strong>. The code must build on all the <a class="reference external" href="http://wiki.sagemath.org/SupportedPlatforms#Fully_supported">fully supported
platforms</a>.</p>
<p>A standard package should also work on all the platforms where Sage
is <a class="reference external" href="http://wiki.sagemath.org/SupportedPlatforms#Expected_to_work">expected to work</a> and
on which Sage <a class="reference external" href="http://wiki.sagemath.org/SupportedPlatforms#Almost_works">almost works</a> but
since we don&#8217;t fully support these platforms and often lack the
resources to test on them, you are not expected to confirm your
packages works on those platforms.</p>
</li>
<li><p class="first"><strong>Quality</strong>. The code should be &#8220;better&#8221; than any other available
code (that passes the two above criteria), and the authors need to
justify this. The comparison should be made to both Python and other
software. Criteria in passing the quality test include:</p>
<ul class="simple">
<li>Speed</li>
<li>Documentation</li>
<li>Usability</li>
<li>Absence of memory leaks</li>
<li>Maintainable</li>
<li>Portability</li>
<li>Reasonable build time, size, dependencies</li>
</ul>
</li>
<li><p class="first"><strong>Previously an optional package</strong>. A new standard package must have
spent some time as an optional package. Or have a good reason why
this is not possible.</p>
</li>
<li><p class="first"><strong>Refereeing</strong>. The code must be refereed, as discussed in
<a class="reference internal" href="trac.html#chapter-sage-trac"><em>The Sage Trac Server</em></a>.</p>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Packaging Third-Party Code</a><ul>
<li><a class="reference internal" href="#package-types">Package types</a></li>
<li><a class="reference internal" href="#directory-structure">Directory Structure</a><ul>
<li><a class="reference internal" href="#package-type">Package type</a></li>
<li><a class="reference internal" href="#install-script">Install Script</a></li>
<li><a class="reference internal" href="#self-tests">Self-Tests</a></li>
<li><a class="reference internal" href="#the-spkg-txt-file">The SPKG.txt File</a></li>
<li><a class="reference internal" href="#package-dependencies">Package dependencies</a></li>
<li><a class="reference internal" href="#patching-sources">Patching Sources</a></li>
<li><a class="reference internal" href="#modified-tarballs">Modified Tarballs</a></li>
<li><a class="reference internal" href="#package-versioning">Package Versioning</a></li>
<li><a class="reference internal" href="#checksums">Checksums</a></li>
</ul>
</li>
<li><a class="reference internal" href="#building-the-package">Building the package</a></li>
<li><a class="reference internal" href="#inclusion-procedure-for-new-and-updated-packages">Inclusion Procedure for New and Updated Packages</a><ul>
<li><a class="reference internal" href="#license-information">License Information</a></li>
<li><a class="reference internal" href="#prerequisites-for-new-standard-packages">Prerequisites for New Standard Packages</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="coding_in_other.html"
                                  title="previous chapter">Using External Libraries and Interfaces</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="packaging_old_spkgs.html"
                                  title="next chapter">Packaging Old-Style SPKGs</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/packaging.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <!-- The shading of the "Go" button should be consistent -->
                <!-- with the colour of the header and footer. See the file -->
                <!-- doc/common/themes/sage/theme.conf for colours used by -->
                <!-- the Sage theme. -->
                <input type="submit" style="background-color: #B8B9F6" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="packaging_old_spkgs.html" title="Packaging Old-Style SPKGs"
             >next</a> |</li>
        <li class="right" >
          <a href="coding_in_other.html" title="Using External Libraries and Interfaces"
             >previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v7.1</a> &raquo;</li>
 
      </ul>
    </div>
    
    <div class="footer">
        &copy; Copyright 2005--2016, The Sage Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
  </body>
</html>