<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>General Conventions &mdash; Sage Developer&#39;s Guide v6.8</title>
    
    <link rel="stylesheet" href="_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '6.8',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Sage Developer&#39;s Guide v6.8" href="index.html" />
    <link rel="next" title="The reviewer’s check list" href="reviewer_checklist.html" />
    <link rel="prev" title="The Sage Trac Server" href="trac.html" />
    <link rel="icon" href="_static/sageicon.png" type="image/x-icon" />

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="reviewer_checklist.html" title="The reviewer’s check list"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="trac.html" title="The Sage Trac Server"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v6.8</a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="general-conventions">
<span id="chapter-code-basics"></span><h1>General Conventions<a class="headerlink" href="#general-conventions" title="Permalink to this headline">¶</a></h1>
<p>There are many ways to contribute to Sage including sharing scripts
and Sage worksheets that implement new functionality using Sage,
improving to the Sage library, or to working on the many underlying
libraries distributed with Sage <a class="footnote-reference" href="#id2" id="id1">[1]</a>.
This guide focuses on editing the Sage library itself.</p>
<p>Sage is not just about gathering together functionality. It is about
providing a clear, systematic and consistent way to access a large
number of algorithms, in a coherent framework that makes sense
mathematically. In the design of Sage, the semantics of objects, the
definitions, etc., are informed by how the corresponding objects are
used in everyday mathematics.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>See <a class="reference external" href="http://www.sagemath.org/links-components.html">http://www.sagemath.org/links-components.html</a> for a full list
of packages shipped with every copy of Sage</td></tr>
</tbody>
</table>
<p>To meet the goal of making Sage easy to read, maintain, and improve,
all Python/Cython code that is included with Sage should adhere to the
style conventions discussed in this chapter.</p>
<div class="section" id="python-code-style">
<span id="section-coding-python"></span><h2>Python Code Style<a class="headerlink" href="#python-code-style" title="Permalink to this headline">¶</a></h2>
<p>Follow the standard Python formatting rules when writing code for
Sage, as explained at the following URLs:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.python.org/dev/peps/pep-0008">http://www.python.org/dev/peps/pep-0008</a></li>
<li><a class="reference external" href="http://www.python.org/dev/peps/pep-0257">http://www.python.org/dev/peps/pep-0257</a></li>
</ul>
<p>In particular,</p>
<ul>
<li><p class="first">Use 4 spaces for indentation levels. Do not use tabs as they can
result in indentation confusion. Most editors have a feature that
will insert 4 spaces when the tab key is hit. Also, many editors
will automatically search/replace leading tabs with 4 spaces.</p>
</li>
<li><p class="first">Whitespace before and after assignment and binary operator of the
lowest priority in the expression:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">No whitespace before or after the <tt class="docutils literal"><span class="pre">=</span></tt> sign if it is used for
keyword arguments:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">complex</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">imag</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">magic</span><span class="p">(</span><span class="n">r</span><span class="o">=</span><span class="n">real</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">imag</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">No whitespace immediately inside parenthesis, brackets, and braces:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">spam</span><span class="p">(</span><span class="n">ham</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">{</span><span class="n">eggs</span><span class="p">:</span> <span class="mi">2</span><span class="p">})</span>
<span class="p">[</span><span class="n">i</span><span class="o">^</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
</pre></div>
</div>
</li>
<li><p class="first">Use all lowercase function names with words separated by
underscores. For example, you are encouraged to write Python
functions using the naming convention:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">set_some_value</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Note, however, that some functions do have uppercase letters where
it makes sense. For instance, the function for lattice reduction by
the LLL algorithm is called <tt class="docutils literal"><span class="pre">Matrix_integer_dense.LLL</span></tt>.</p>
</li>
<li><p class="first">Use CamelCase for class names:</p>
<div class="highlight-python"><div class="highlight"><pre>class SomeValue(object):
    def __init__(self, x):
    self._x  = 1
</pre></div>
</div>
<p>and factory functions that mimic object constructors, for example
<tt class="docutils literal"><span class="pre">PolynomialRing</span></tt> or:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">SomeIdentityValue</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">SomeValue</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="files-and-directory-structure">
<span id="chapter-directory-structure"></span><h2>Files and Directory Structure<a class="headerlink" href="#files-and-directory-structure" title="Permalink to this headline">¶</a></h2>
<p>Roughly, the Sage directory tree is layout like this. Note that we use
<tt class="docutils literal"><span class="pre">SAGE_ROOT</span></tt> in the following as a shortcut for the (arbitrary) name
of the directory containing the Sage sources:</p>
<div class="highlight-python"><div class="highlight"><pre>SAGE_ROOT/
    sage          # the Sage launcher
    Makefile      # top level Makefile
    build/        # sage&#39;s build system
        deps
        install
        ...
        pkgs/     # install, patch, and metadata from spkgs
    src/
        setup.py
        module_list.py
        ...
        sage/     # sage library (formerly devel/sage-main/sage)
        ext/      # extra sage resources (formerly devel/ext-main)
        mac-app/  # would no longer have to awkwardly be in extcode
        bin/      # the scripts in local/bin that are tracked
    upstream/     # tarballs of upstream sources
    local/        # installed binaries
</pre></div>
</div>
<p>Python Sage library code goes into <tt class="docutils literal"><span class="pre">src/</span></tt> and uses the following
conventions. Directory names may be plural (e.g. <tt class="docutils literal"><span class="pre">rings</span></tt>) and file
names are almost always singular (e.g. <tt class="docutils literal"><span class="pre">polynomial_ring.py</span></tt>). Note
that the file <tt class="docutils literal"><span class="pre">polynomial_ring.py</span></tt> might still contain definitions
of several different types of polynomial rings.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You are encouraged to include miscellaneous notes, emails, design
discussions, etc., in your package.  Make these plain text files
(with extension <tt class="docutils literal"><span class="pre">.txt</span></tt>) in a subdirectory called <tt class="docutils literal"><span class="pre">notes</span></tt>.  For
example, see <tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/ext/notes/</span></tt>.</p>
</div>
<p>If you want to create a new directory in the Sage library
<tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage</span></tt> (say, <tt class="docutils literal"><span class="pre">measure_theory</span></tt>), that directory
should contain a file <tt class="docutils literal"><span class="pre">__init__.py</span></tt> that contains the single line
<tt class="docutils literal"><span class="pre">import</span> <span class="pre">all</span></tt> in addition to whatever
files you want to add (say, <tt class="docutils literal"><span class="pre">borel_measure.py</span></tt> and
<tt class="docutils literal"><span class="pre">banach_tarski.py</span></tt>), and also a file <tt class="docutils literal"><span class="pre">all.py</span></tt> listing imports from
that directory that are important enough to be in the Sage’s global
namespace at startup.
The file <tt class="docutils literal"><span class="pre">all.py</span></tt> might look like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">borel_measure</span> <span class="kn">import</span> <span class="n">BorelMeasure</span>
<span class="kn">from</span> <span class="nn">banach_tarski</span> <span class="kn">import</span> <span class="n">BanachTarskiParadox</span>
</pre></div>
</div>
<p>but it is generally better to use the lazy import framework:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sage.misc.lazy_import</span> <span class="kn">import</span> <span class="n">lazy_import</span>
<span class="n">lazy_import</span><span class="p">(</span><span class="s">&#39;sage.measure_theory.borel_measue&#39;</span><span class="p">,</span> <span class="s">&#39;BorelMeasure&#39;</span><span class="p">)</span>
<span class="n">lazy_import</span><span class="p">(</span><span class="s">&#39;sage.measure_theory.banach_tarski&#39;</span><span class="p">,</span> <span class="s">&#39;BanachTarskiParadox&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then in the file <tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/all.py</span></tt>, add a line</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sage.measure_theory.all</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
<div class="section" id="learn-by-copy-paste">
<h2>Learn by copy/paste<a class="headerlink" href="#learn-by-copy-paste" title="Permalink to this headline">¶</a></h2>
<p>For all of the conventions discussed here, you can find many examples
in the Sage library.  Browsing through the code is helpful, but so is
searching: the functions <tt class="docutils literal"><span class="pre">search_src</span></tt>, <tt class="docutils literal"><span class="pre">search_def</span></tt>, and
<tt class="docutils literal"><span class="pre">search_doc</span></tt> are worth knowing about.  Briefly, from the &#8220;sage:&#8221;
prompt, <tt class="docutils literal"><span class="pre">search_src(string)</span></tt> searches Sage library code for the
string <tt class="docutils literal"><span class="pre">string</span></tt>. The command <tt class="docutils literal"><span class="pre">search_def(string)</span></tt> does a similar
search, but restricted to function definitions, while
<tt class="docutils literal"><span class="pre">search_doc(string)</span></tt> searches the Sage documentation.  See their
docstrings for more information and more options.</p>
</div>
<div class="section" id="headings-of-sage-library-code-files">
<h2>Headings of Sage Library Code Files<a class="headerlink" href="#headings-of-sage-library-code-files" title="Permalink to this headline">¶</a></h2>
<p>The top of each Sage code file should follow this format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">&lt;Very short 1-line summary&gt;</span>

<span class="sd">&lt;Paragraph description&gt;</span>

<span class="sd">AUTHORS:</span>

<span class="sd">- YOUR NAME (2005-01-03): initial version</span>

<span class="sd">- person (date in ISO year-month-day format): short desc</span>

<span class="sd">EXAMPLES::</span>

<span class="sd">&lt;Lots and lots of examples&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c">#*****************************************************************************</span>
<span class="c">#       Copyright (C) 2013 YOUR NAME &lt;your email&gt;</span>
<span class="c">#</span>
<span class="c"># This program is free software: you can redistribute it and/or modify</span>
<span class="c"># it under the terms of the GNU General Public License as published by</span>
<span class="c"># the Free Software Foundation, either version 2 of the License, or</span>
<span class="c"># (at your option) any later version.</span>
<span class="c">#                  http://www.gnu.org/licenses/</span>
<span class="c">#*****************************************************************************</span>
</pre></div>
</div>
<p>As an example, see <tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/rings/integer.pyx</span></tt> which
contains the implementation for <span class="math">\(\ZZ\)</span>. The <tt class="docutils literal"><span class="pre">AUTHORS:</span></tt> section is
redundant, the authoritative log for who wrote what is always the git
repository (see the output of <tt class="docutils literal"><span class="pre">git</span> <span class="pre">blame</span></tt>). Nevertheless, it is
sometimes useful to have a very rough overview over the history,
especially if a lot of people have been working on that source file.</p>
<p>All code included with Sage must be licensed under the GPLv2+ or a
compatible, that is, less restrictive license (e.g. the BSD license).</p>
</div>
<div class="section" id="documentation-strings">
<span id="section-docstrings"></span><h2>Documentation Strings<a class="headerlink" href="#documentation-strings" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-docstring-of-a-function-content">
<span id="section-docstring-function"></span><h3>The docstring of a function: content<a class="headerlink" href="#the-docstring-of-a-function-content" title="Permalink to this headline">¶</a></h3>
<p><strong>Every</strong> function must have a docstring that includes the following
information. You can use the existing functions of Sage as templates.</p>
<ul>
<li><p class="first">A <strong>one-sentence description</strong> of the function.</p>
<p>It must be followed by a blank line and end in a period.  It
describes the function or method&#8217;s effect as a command (&#8220;Do this&#8221;,
&#8220;Return that&#8221;), not as a description like &#8220;Returns the pathname ...&#8221;.</p>
</li>
<li><p class="first">An <strong>INPUT</strong> and an <strong>OUTPUT</strong> block describing the input/output of
the function. This is not optional.</p>
<p>The INPUT block describes all arguments that the function accepts,
and the OUTPUT section describes its expected output.</p>
<ol class="arabic simple">
<li>The type names should be descriptive, but do not have to represent
the exact Sage/Python types. For example, use &#8220;integer&#8221; for
anything that behaves like an integer, rather than <tt class="docutils literal"><span class="pre">int</span></tt>.</li>
<li>Mention the default values of the input arguments when applicable.</li>
</ol>
<p>Example:</p>
<div class="highlight-python"><div class="highlight"><pre>INPUT:

- ``p`` -- (default: 2) a positive prime integer.

OUTPUT:

A 5-tuple consisting of integers in this order:

1. the smallest primitive root modulo p
2. the smallest prime primitive root modulo p
3. the largest primitive root modulo p
4. the largest prime primitive root modulo p
5. total number of prime primitive roots modulo p
</pre></div>
</div>
<p>You can start the OUTPUT block with a dash if you prefer:</p>
<div class="highlight-python"><div class="highlight"><pre>OUTPUT:

- The plaintext resulting from decrypting the ciphertext ``C``
  using the Blum-Goldwasser decryption algorithm.
</pre></div>
</div>
</li>
<li><p class="first">An <strong>EXAMPLES</strong> block for examples. This is not optional.</p>
<p>These examples are used both for:</p>
<ol class="arabic simple">
<li>Documentation</li>
<li>Automatic testing before each release.</li>
</ol>
<p>They should have good coverage of the functionality in question.</p>
</li>
<li><p class="first">A <strong>SEEALSO</strong> block (highly recommended) with links to related parts of
Sage. This helps users find the features that interests them and discover the
new ones.</p>
<div class="highlight-python"><div class="highlight"><pre>.. SEEALSO::

    :ref:`chapter-sage_manuals_links`,
    :meth:`sage.somewhere.other_useful_method`,
    :mod:`sage.some.related.module`.
</pre></div>
</div>
<p>See <a class="reference internal" href="sage_manuals.html#chapter-sage-manuals-links"><em>Hyperlinks</em></a> for details on how to setup
link in Sage.</p>
</li>
<li><p class="first">An <strong>ALGORITHM</strong> block (optional).</p>
<p>It indicates what algorithm and/or what software is used, e.g.
<tt class="docutils literal"><span class="pre">ALGORITHM:</span> <span class="pre">Uses</span> <span class="pre">Pari</span></tt>. Here&#8217;s a longer example with a
bibliographical reference:</p>
<div class="highlight-python"><div class="highlight"><pre>ALGORITHM:

The following algorithm is adapted from page 89 of [Nat2000]_.

Let `p` be an odd (positive) prime and let `g` be a generator
modulo `p`. Then `g^k` is a generator modulo `p` if and only if
`\gcd(k, p-1) = 1`. Since `p` is an odd prime and positive, then
`p - 1` is even so that any even integer between 1 and `p - 1`,
inclusive, is not relatively prime to `p - 1`. We have now
narrowed our search to all odd integers `k` between 1 and `p - 1`,
inclusive.

So now start with a generator `g` modulo an odd (positive) prime
`p`. For any odd integer `k` between 1 and `p - 1`, inclusive,
`g^k` is a generator modulo `p` if and only if `\gcd(k, p-1) = 1`.

REFERENCES:

.. [Nat2000] M.B. Nathanson. Elementary Methods in Number Theory.
   Springer, 2000.
</pre></div>
</div>
</li>
<li><p class="first">A <strong>NOTE</strong> block for tips/tricks (optional).</p>
<div class="highlight-python"><div class="highlight"><pre>.. NOTE::

    You should note that this sentence is indented at least 4
    spaces. Never use the tab character.
</pre></div>
</div>
</li>
<li><p class="first">A <strong>WARNING</strong> block for critical information about your code (optional).</p>
<p>For example known situations for which the code breaks, or anything
that the user should be aware of.</p>
<div class="highlight-python"><div class="highlight"><pre>.. WARNING::

    Whenever you edit the Sage documentation, make sure that
    the edited version still builds. That is, you need to ensure
    that you can still build the HTML and PDF versions of the
    updated documentation. If the edited documentation fails to
    build, it is very likely that you would be requested to
    change your patch.
</pre></div>
</div>
</li>
<li><p class="first">A <strong>TODO</strong> block for future improvements (optional).</p>
<p>It can contain disabled doctests to demonstrate the desired
feature. Here&#8217;s an example of a TODO block:</p>
<div class="highlight-python"><div class="highlight"><pre>.. TODO::

    Add to ``have_fresh_beers`` an interface with the faster
    algorithm &quot;Buy a Better Fridge&quot; (BaBF)::

        sage: have_fresh_beers(&#39;Bière de l\&#39;Yvette&#39;, algorithm=&quot;BaBF&quot;) # not implemented
        Enjoy !
</pre></div>
</div>
</li>
<li><p class="first">A <strong>PLOT</strong> block to illustrate with pictures the output of a function.</p>
<p>Generate with Sage code an object <tt class="docutils literal"><span class="pre">g</span></tt> with a <tt class="docutils literal"><span class="pre">.plot</span></tt> method, then call
<tt class="docutils literal"><span class="pre">sphinx_plot(g)</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>.. PLOT::

    g = graphs.PetersenGraph()
    sphinx_plot(g)
</pre></div>
</div>
</li>
<li><p class="first">A <strong>REFERENCES</strong> block to list related books or papers (optional)</p>
<p>It should cite the books/research papers relevant to the code, e.g. the source
of the algorithm that it implements.</p>
<div class="highlight-python"><div class="highlight"><pre>This docstring is referencing [SC]_. Just remember that references
are global, so we can also reference to [Nat2000]_ in the ALGORITHM
block, even if it is in a separate file. However we would not
include the reference here since it would cause a conflict.

REFERENCES:

.. [SC] Conventions for coding in sage.
   http://www.sagemath.org/doc/developer/conventions.html.
</pre></div>
</div>
<p>See the <a class="reference external" href="http://sphinx.pocoo.org/rest.html#citations">Sphinx/ReST markup for citations</a>. For links toward trac tickets or wikipedia, see <a class="reference internal" href="sage_manuals.html#chapter-sage-manuals-links"><em>Hyperlinks</em></a>.</p>
</li>
<li><p class="first">A <strong>TESTS</strong> block (optional)</p>
<p>Formatted just like EXAMPLES, containing tests that are not relevant to users.</p>
</li>
</ul>
<div class="section" id="template">
<h4>Template<a class="headerlink" href="#template" title="Permalink to this headline">¶</a></h4>
<p>Use the following template when documenting functions. Note the
indentation:</p>
<div class="highlight-python"><div class="highlight"><pre>def point(self, x=1, y=2):
    r&quot;&quot;&quot;
    Return the point `(x^5,y)`.

    INPUT:

    - ``x`` -- integer (default: 1) the description of the
      argument ``x`` goes here.  If it contains multiple lines, all
      the lines after the first need to begin at the same indentation
      as the backtick.

    - ``y`` -- integer (default: 2) the ...

    OUTPUT:

    The point as a tuple.

    .. SEEALSO::

        :func:`line`

    EXAMPLES:

    This example illustrates ...

    ::

        sage: A = ModuliSpace()
        sage: A.point(2,3)
        xxx

    We now ...

    ::

        sage: B = A.point(5,6)
        sage: xxx

    It is an error to ...::

        sage: C = A.point(&#39;x&#39;,7)
        Traceback (most recent call last):
        ...
        TypeError: unable to convert &#39;r&#39; to an integer

    .. NOTE::

        This function uses the algorithm of [BCDT]_ to determine
        whether an elliptic curve `E` over `Q` is modular.

    ...

    REFERENCES:

    .. [BCDT] Breuil, Conrad, Diamond, Taylor,
       &quot;Modularity ....&quot;
    &quot;&quot;&quot;
    &lt;body of the function&gt;
</pre></div>
</div>
<p>You are strongly encouraged to:</p>
<ul>
<li><p class="first">Use LaTeX typesetting (see <a class="reference internal" href="#section-latex-typeset"><em>LaTeX Typesetting</em></a>).</p>
</li>
<li><p class="first">Liberally describe what the examples do.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There must be a blank line after the example code and before the
explanatory text for the next example (indentation is not enough).</p>
</div>
</li>
<li><p class="first">Illustrate the exceptions raised by the function with examples (as
given above: &#8220;It is an error to [..]&#8221;, ...)</p>
</li>
<li><p class="first">Include many examples.</p>
<p>They are helpful for the users, and are crucial for the quality and
adaptability of Sage. Without such examples, small changes to one part
of Sage that break something else might not go seen until much later
when someone uses the system, which is unacceptable.</p>
</li>
</ul>
</div>
<div class="section" id="private-functions">
<h4>Private functions<a class="headerlink" href="#private-functions" title="Permalink to this headline">¶</a></h4>
<p>Functions whose names start with an underscore are considered
private. They do not appear in the reference manual, and their docstring
should not contain any information that is crucial for Sage users. You
can make their docstrings be part of the documentation of another
method. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">SageObject</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &lt;usual docstring&gt;</span>

<span class="sd">        .. automethod:: _f</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_f</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_f</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
         <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">         This would be hidden without the ``.. automethod::``</span>
<span class="sd">         &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Private functions should contain an EXAMPLES (or TESTS) block.</p>
<p>A special case is the constructor <tt class="docutils literal"><span class="pre">__init__</span></tt>: due to its special
status the <tt class="docutils literal"><span class="pre">__init__</span></tt> docstring is used as the class docstring if
there is not one already. That is, you can do the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">sage: </span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">SageObject</span><span class="p">):</span>
<span class="go">....:     # no class docstring</span>
<span class="go">....:     def __init__(self):</span>
<span class="go">....:         &quot;&quot;&quot;Construct a Foo.&quot;&quot;&quot;</span>
<span class="gp">sage: </span><span class="n">foo</span> <span class="o">=</span> <span class="n">Foo</span><span class="p">()</span>
<span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.misc.sageinspect</span> <span class="kn">import</span> <span class="n">sage_getdoc</span>
<span class="gp">sage: </span><span class="n">sage_getdoc</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span>              <span class="c"># class docstring</span>
<span class="go">&#39;Construct a Foo.\n&#39;</span>
<span class="gp">sage: </span><span class="n">sage_getdoc</span><span class="p">(</span><span class="n">foo</span><span class="o">.</span><span class="n">__init__</span><span class="p">)</span>     <span class="c"># constructor docstring</span>
<span class="go">&#39;Construct a Foo.\n&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="latex-typesetting">
<span id="section-latex-typeset"></span><h3>LaTeX Typesetting<a class="headerlink" href="#latex-typesetting" title="Permalink to this headline">¶</a></h3>
<p>In Sage&#8217;s documentation LaTeX code is allowed and is marked with <strong>backticks or
dollar signs</strong>:</p>
<blockquote>
<div><tt class="docutils literal"><span class="pre">`x^2</span> <span class="pre">+</span> <span class="pre">y^2</span> <span class="pre">=</span> <span class="pre">1`</span></tt> and <tt class="docutils literal"><span class="pre">$x^2</span> <span class="pre">+</span> <span class="pre">y^2</span> <span class="pre">=</span> <span class="pre">1$</span></tt> both yield <span class="math">\(x^2 + y^2 = 1\)</span>.</div></blockquote>
<p><strong>Backslashes:</strong> For LaTeX commands containing backslashes, either use double
backslashes or begin the docstring with a <tt class="docutils literal"><span class="pre">r&quot;&quot;&quot;</span></tt> instead of <tt class="docutils literal"><span class="pre">&quot;&quot;&quot;</span></tt>. Both of
the following are valid:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">cos</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return `\\cos(x)`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">sin</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">r&quot;&quot;&quot;</span>
<span class="sd">    Return $\sin(x)$.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<p><strong>MATH block:</strong> This is similar to the LaTeX syntax <tt class="docutils literal"><span class="pre">\[&lt;math</span> <span class="pre">expression&gt;\]</span></tt> (or
<tt class="docutils literal"><span class="pre">$$&lt;math</span> <span class="pre">expression&gt;$$</span></tt>). For instance:</p>
<div class="highlight-python"><div class="highlight"><pre>.. MATH::

    \sum_{i=1}^{\infty} (a_1 a_2 \cdots a_i)^{1/i}
    \leq
    e \sum_{i=1}^{\infty} a_i
</pre></div>
</div>
<div class="math">
\[\sum_{i=1}^{\infty} (a_1 a_2 \cdots a_i)^{1/i}
\leq
e \sum_{i=1}^{\infty} a_i\]</div>
<p>The <strong>aligned</strong> environment works as it does in LaTeX:</p>
<div class="highlight-python"><div class="highlight"><pre>.. MATH::

    \begin{aligned}
     f(x) &amp; = x^2 - 1 \\
     g(x) &amp; = x^x - f(x - 2)
    \end{aligned}
</pre></div>
</div>
<div class="math">
\[\begin{split}\begin{aligned}
 f(x) &amp; = x^2 - 1 \\
 g(x) &amp; = x^x - f(x - 2)
\end{aligned}\end{split}\]</div>
<p>When building the PDF documentation, everything is translated to LaTeX
and each MATH block is automatically wrapped in a math environment &#8211;
in particular, it is turned into <tt class="docutils literal"><span class="pre">\begin{gather}</span> <span class="pre">block</span>
<span class="pre">\end{gather}</span></tt>.  So if you want to use a LaTeX environment (like
<tt class="docutils literal"><span class="pre">align</span></tt>) which in ordinary LaTeX would not be wrapped like this, you
must add a <strong>:nowrap:</strong> flag to the MATH mode. See also <a class="reference external" href="http://sphinx-doc.org/latest/ext/math.html?highlight=nowrap#directive-math">Sphinx&#8217;s
documentation for math blocks</a>.</p>
<div class="highlight-python"><div class="highlight"><pre>.. MATH::
   :nowrap:

   \begin{align}
      1+...+n &amp;= n(n+1)/2\\
      &amp;= O(n^2)\\
   \end{tabular}
</pre></div>
</div>
<div class="math">
\[\begin{align}
1+...+n &= n(n+1)/2\\
&= O(n^2)\\
\end{align}\]</div><p><strong>Readability balance:</strong> in the interactive console, LaTeX formulas contained in
the documentation are represented by their LaTeX code (with
backslashes stripped). In this situation <tt class="docutils literal"><span class="pre">\\frac{a}{b}</span></tt> is less readable than <tt class="docutils literal"><span class="pre">a/b</span></tt>
or <tt class="docutils literal"><span class="pre">a</span> <span class="pre">b^{-1}</span></tt> (some users may not even know LaTeX code). Make it pleasant for
everybody as much as you can manage.</p>
<p><strong>Commons rings</strong> <span class="math">\((\Bold{Z},\Bold{N},...)\)</span>: The Sage LaTeX style is to typeset
standard rings and fields using the locally-defined macro <tt class="docutils literal"><span class="pre">\\Bold</span></tt>
(e.g. <tt class="docutils literal"><span class="pre">\\Bold{Z}</span></tt> gives <span class="math">\(\Bold{Z}\)</span>).</p>
<p><strong>Shortcuts</strong> are available which preserve readability, e.g. <tt class="docutils literal"><span class="pre">\\ZZ</span></tt> (<span class="math">\(\ZZ\)</span>),
<tt class="docutils literal"><span class="pre">\\RR</span></tt> (<span class="math">\(\RR\)</span>), <tt class="docutils literal"><span class="pre">\\CC</span></tt> (<span class="math">\(\CC\)</span>), and <tt class="docutils literal"><span class="pre">\\QQ</span></tt> (<span class="math">\(\QQ\)</span>). They appear as
LaTeX-formatted <tt class="docutils literal"><span class="pre">\\Bold{Z}</span></tt> in the html manual, and as <tt class="docutils literal"><span class="pre">Z</span></tt> in the
interactive help. Other examples: <tt class="docutils literal"><span class="pre">\\GF{q}</span></tt> (<span class="math">\(\GF{q}\)</span>) and <tt class="docutils literal"><span class="pre">\\Zmod{p}</span></tt>
(<span class="math">\(\Zmod{p}\)</span>).</p>
<p>See the file <tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/misc/latex_macros.py</span></tt> for a full list and
for details about how to add more macros.</p>
</div>
<div class="section" id="writing-testable-examples">
<span id="section-doctest-writing"></span><h3>Writing Testable Examples<a class="headerlink" href="#writing-testable-examples" title="Permalink to this headline">¶</a></h3>
<p>The examples from Sage&#8217;s documentation have a double purpose:</p>
<ul class="simple">
<li>They provide <strong>illustrations</strong> of the code&#8217;s usage to the users</li>
<li>They are <strong>tests</strong> that are checked before each release, helping us avoid
new bugs.</li>
</ul>
<p>All new doctests added to Sage should <strong>pass all tests</strong> (see
<a class="reference internal" href="doctesting.html#chapter-doctesting"><em>Running Sage&#8217;s doctests</em></a>), i.e. running <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">your_file.py</span></tt> should not
give any error messages. Below are instructions about how doctests should be
written.</p>
<p><strong>What doctests should test:</strong></p>
<ul>
<li><p class="first"><strong>Interesting examples</strong> of what the function can do. This will be the
most helpful to a lost user. It is also the occasion to check famous
theorems (just in case):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">sage: </span><span class="n">is_prime</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="c"># 6 is not prime</span>
<span class="go">False</span>
<span class="gp">sage: </span><span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span> <span class="c"># and here is a proof</span>
<span class="go">6</span>
</pre></div>
</div>
</li>
<li><p class="first">All <strong>meaningful combinations</strong> of input arguments. For example a function may
accept an <tt class="docutils literal"><span class="pre">algorithm=&quot;B&quot;</span></tt> argument, and doctests should involve both
<tt class="docutils literal"><span class="pre">algorithm=&quot;A&quot;</span></tt> and <tt class="docutils literal"><span class="pre">algorithm=&quot;B&quot;</span></tt>.</p>
</li>
<li><p class="first"><strong>Corner cases:</strong> the code should be able to handle a 0 input, or an empty
set, or a null matrix, or a null function, ... All corner cases should be
checked, as they are the most likely to be broken, now or in the future. This
probably belongs to the TESTS block (see <a class="reference internal" href="#section-docstring-function"><em>The docstring of a function: content</em></a>).</p>
</li>
<li><p class="first"><strong>Systematic tests</strong> of all small-sized inputs, or tests of <strong>random</strong>
instances if possible.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that <strong>TestSuites</strong> are an automatic way to generate some of these
tests in specific situations. See
<tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/misc/sage_unittest.py</span></tt>.</p>
</div>
</li>
</ul>
<p><strong>The syntax:</strong></p>
<ul>
<li><p class="first"><strong>Environment:</strong> doctests should work if you copy/paste them in Sage&#8217;s
interactive console. For example, the function <tt class="docutils literal"><span class="pre">AA()</span></tt> in the file
<tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/algebras/steenrod/steenrod_algebra.py</span></tt> includes an
EXAMPLES block containing the following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">sage: </span><span class="kn">from</span> <span class="nn">sage.algebras.steenrod.steenrod_algebra</span> <span class="kn">import</span> <span class="n">AA</span> <span class="k">as</span> <span class="n">A</span>
<span class="gp">sage: </span><span class="n">A</span><span class="p">()</span>
<span class="go">mod 2 Steenrod algebra, milnor basis</span>
</pre></div>
</div>
<p>Sage does not know about the function <tt class="docutils literal"><span class="pre">AA()</span></tt> by default, so it needs to be
imported before it is tested. Hence the first line in the example.</p>
</li>
<li><p class="first"><strong>Preparsing:</strong> As in Sage&#8217;s console, <span class="math">\(4/3\)</span> returns <span class="math">\(4/3\)</span> and not <span class="math">\(1\)</span> as in
Python 2.7. Testing occurs with full Sage preparsing of input within the standard
Sage shell environment, as described in <a class="reference internal" href="coding_in_python.html#section-preparsing"><em>Sage Preparsing</em></a>.</p>
</li>
<li><p class="first"><strong>Writing files:</strong> If a test outputs to a file, the file should be a temporary
file.  Use <a class="reference external" href="../reference/misc/sage/misc/temporary_file.html#sage.misc.temporary_file.tmp_filename" title="(in Sage Reference Manual: Utilities v6.8)"><tt class="xref py py-func docutils literal"><span class="pre">tmp_filename()</span></tt></a> to get a temporary filename, or
<a class="reference external" href="../reference/misc/sage/misc/temporary_file.html#sage.misc.temporary_file.tmp_dir" title="(in Sage Reference Manual: Utilities v6.8)"><tt class="xref py py-func docutils literal"><span class="pre">tmp_dir()</span></tt></a> to get a temporary directory. An example from
<tt class="docutils literal"><span class="pre">SAGE_ROOT/src/sage/plot/graphics.py</span></tt>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">sage: </span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">^</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">tmp_filename</span><span class="p">(</span><span class="n">ext</span><span class="o">=</span><span class="s">&#39;.png&#39;</span><span class="p">))</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Multiline doctests:</strong> You may write tests that span multiple lines, using
the line continuation marker <tt class="docutils literal"><span class="pre">....:</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">sage: </span><span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">srange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">):</span>
<span class="go">....:     if n.is_prime():</span>
<span class="go">....:         print n,</span>
<span class="go">2 3 5 7</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Split long lines:</strong> You may want to split long lines of code with a
backslash. Note: this syntax is non-standard and may be removed in the
future:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">sage: </span><span class="n">n</span> <span class="o">=</span> <span class="mi">123456789123456789123456789</span>\
<span class="go">....:     123456789123456789123456789</span>
<span class="gp">sage: </span><span class="n">n</span><span class="o">.</span><span class="n">is_prime</span><span class="p">()</span>
<span class="go">False</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>Doctests flags:</strong> flags are available to change the behaviour of doctests:
see <a class="reference internal" href="#section-further-conventions"><em>Special Markup to Influence Tests</em></a>.</p>
</li>
</ul>
</div>
<div class="section" id="special-markup-to-influence-tests">
<span id="section-further-conventions"></span><h3>Special Markup to Influence Tests<a class="headerlink" href="#special-markup-to-influence-tests" title="Permalink to this headline">¶</a></h3>
<p>There are a number of magic comments that you can put into the example
code that change how the output is verified by the Sage doctest
framework. Here is a comprehensive list:</p>
<ul>
<li><p class="first"><strong>random:</strong> The line will be executed, but its output will not be checked with
the output in the documentation string:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">sage: </span><span class="n">c</span> <span class="o">=</span> <span class="n">CombinatorialObject</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="gp">sage: </span><span class="nb">hash</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c"># random</span>
<span class="go">1335416675971793195</span>
<span class="gp">sage: </span><span class="nb">hash</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>  <span class="c"># random</span>
<span class="go">This doctest passes too, as the output is not checked</span>
</pre></div>
</div>
<p>However, most functions generating pseudorandom output do not need this tag
since the doctesting framework guarantees the state of the pseudorandom number
generators (PRNGs) used in Sage for a given doctest.</p>
<p>When possible, avoid the problem, e.g.: rather than checking the value of the
hash in a doctest, one could illustrate successfully using it as a key in a
dict.</p>
</li>
<li><p class="first"><strong>long time:</strong> The line is only tested if the <tt class="docutils literal"><span class="pre">--long</span></tt> option is given, e.g.
<tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">--long</span> <span class="pre">f.py</span></tt>.</p>
<p>Use it for doctests that take more than a second to run. No example should
take more than about 30 seconds:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">sage: </span><span class="n">E</span> <span class="o">=</span> <span class="n">EllipticCurve</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="gp">sage: </span><span class="n">E</span><span class="o">.</span><span class="n">regulator</span><span class="p">()</span>        <span class="c"># long time (1 second)</span>
<span class="go">0.0511114082399688</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>tol</strong> or <strong>tolerance:</strong> The numerical values returned by the line are only
verified to the given tolerance. It is useful when the output is subject to
numerical noise due to system-dependent (floating point arithmetic, math
libraries, ...) or non-deterministic algorithms.</p>
<ul class="simple">
<li>This may be prefixed by <tt class="docutils literal"><span class="pre">abs[olute]</span></tt> or <tt class="docutils literal"><span class="pre">rel[ative]</span></tt> to specify whether
to measure <strong>absolute</strong> or <strong>relative</strong> error (see the
<a class="reference external" href="https://en.wikipedia.org/wiki/Approximation_error">Wikipedia article Approximation_error</a>).</li>
<li>If none of <tt class="docutils literal"><span class="pre">abs/rel</span></tt> is specified, the error is considered to be
<tt class="docutils literal"><span class="pre">absolute</span></tt> when the expected value is <strong>zero</strong>, and is <tt class="docutils literal"><span class="pre">relative</span></tt> for
<strong>nonzero</strong> values.</li>
</ul>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">sage: </span><span class="n">n</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>  <span class="c"># abs tol 1e-9</span>
<span class="go">3.14159265358979</span>
<span class="gp">sage: </span><span class="n">n</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>  <span class="c"># rel tol 2</span>
<span class="go">6</span>
<span class="gp">sage: </span><span class="n">n</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>  <span class="c"># abs tol 1.41593</span>
<span class="go">2</span>
<span class="gp">sage: </span><span class="n">K</span><span class="o">.&lt;</span><span class="n">zeta8</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">CyclotomicField</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="gp">sage: </span><span class="n">N</span><span class="p">(</span><span class="n">zeta8</span><span class="p">)</span>  <span class="c"># absolute tolerance 1e-10</span>
<span class="go">0.7071067812 + 0.7071067812*I</span>
</pre></div>
</div>
<p><strong>Multiple numerical values:</strong> the representation of complex numbers,
matrices, or polynomials usually involves several numerical values. If a
doctest with tolerance contains several numbers, each of them is checked
individually:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">sage: </span><span class="k">print</span> <span class="s">&quot;The sum of 1 and 1 equals 5&quot;</span>  <span class="c"># abs tol 1</span>
<span class="go">The sum of 2 and 2 equals 4</span>
<span class="gp">sage: </span><span class="n">e</span><span class="o">^</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">n</span><span class="p">()</span> <span class="c"># rel tol 1e-1</span>
<span class="go">0.7 + 0.7*I</span>
<span class="gp">sage: </span><span class="p">((</span><span class="n">x</span><span class="o">+</span><span class="mf">1.001</span><span class="p">)</span><span class="o">^</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">()</span> <span class="c"># rel tol 2</span>
<span class="go">x^4 + 4*x^3 + 6*x^2 + 4*x + 1</span>
<span class="gp">sage: </span><span class="n">M</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">random_matrix</span><span class="p">(</span><span class="n">RR</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="o">^</span><span class="mi">3</span>
<span class="gp">sage: </span><span class="n">M</span><span class="o">^</span><span class="mi">2</span> <span class="c"># abs tol 1e-2</span>
<span class="go">[1 0 0]</span>
<span class="go">[0 1 0]</span>
<span class="go">[0 0 1]</span>
</pre></div>
</div>
<p>The values that the doctesting framework involves in the error computations
are defined by the regular expression <tt class="docutils literal"><span class="pre">float_regex</span></tt> in
<a class="reference external" href="../reference/doctest/sage/doctest/parsing.html#module-sage.doctest.parsing" title="(in Sage Reference Manual: Sage's Doctesting Framework v6.8)"><tt class="xref py py-mod docutils literal"><span class="pre">sage.doctest.parsing</span></tt></a>.</p>
</li>
<li><p class="first"><strong>not implemented</strong> or <strong>not tested:</strong> The line is never tested.</p>
<p>Use it for very long doctests that are only meant as documentation. It can
also be used for todo notes of what will eventually be implemented:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">sage: </span><span class="n">factor</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">)</span>    <span class="c"># todo: not implemented</span>
</pre></div>
</div>
<p>It is also immediately clear to the user that the indicated example
does not currently work.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Skip all doctests of a file/directory</p>
<ul class="simple">
<li><strong>file:</strong> If one of the first 10 lines of a file starts with any of
<tt class="docutils literal"><span class="pre">r&quot;&quot;&quot;</span> <span class="pre">nodoctest</span></tt> (or <tt class="docutils literal"><span class="pre">&quot;&quot;&quot;</span> <span class="pre">nodoctest</span></tt> or <tt class="docutils literal"><span class="pre">#</span> <span class="pre">nodoctest</span></tt> or <tt class="docutils literal"><span class="pre">%</span>
<span class="pre">nodoctest</span></tt> or <tt class="docutils literal"><span class="pre">..</span> <span class="pre">nodoctest</span></tt>, or any of these with different spacing),
then that file will be skipped.</li>
<li><strong>directory:</strong> If a directory contains a file <tt class="docutils literal"><span class="pre">nodoctest.py</span></tt>, then that
whole directory will be skipped.</li>
</ul>
<p class="last">Neither of this applies to files or directories which are explicitly given
as command line arguments: those are always tested.</p>
</div>
</li>
<li><p class="first"><strong>optional:</strong> A line flagged with <tt class="docutils literal"><span class="pre">optional</span> <span class="pre">-</span> <span class="pre">keyword</span></tt> is not tested unless
the <tt class="docutils literal"><span class="pre">--optional=keyword</span></tt> flag is passed to <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span></tt> (see
<a class="reference internal" href="doctesting.html#section-optional-doctest-flag"><em>Run Optional Tests</em></a>). The main applications are:</p>
<ul>
<li><p class="first"><strong>optional packages:</strong> When a line requires an optional package to be
installed (e.g. the <tt class="docutils literal"><span class="pre">sloane_database</span></tt> package):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">sage: </span><span class="n">SloaneEncyclopedia</span><span class="p">[</span><span class="mi">60843</span><span class="p">]</span>    <span class="c"># optional - sloane_database</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>internet:</strong> For lines that require an internet connection:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">sage: </span><span class="n">sloane_sequence</span><span class="p">(</span><span class="mi">60843</span><span class="p">)</span>       <span class="c"># optional - internet</span>
</pre></div>
</div>
</li>
<li><p class="first"><strong>bug:</strong> For lines that describe bugs. Alternatively, use <tt class="docutils literal"><span class="pre">#</span> <span class="pre">known</span> <span class="pre">bug</span></tt>
instead: it is an alias for <tt class="docutils literal"><span class="pre">optional</span> <span class="pre">bug</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre>The following should yield 4.  See :trac:`2`. ::

    sage: 2+2  # optional: bug
    5
    sage: 2+2  # known bug
    5
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li>Any words after <tt class="docutils literal"><span class="pre">#</span> <span class="pre">optional</span></tt> are interpreted as a list of
package names, separated by spaces.</li>
<li>Any punctuation (periods, commas, hyphens, semicolons, ...) after the
first word ends the list of packages.  Hyphens or colons between the
word <tt class="docutils literal"><span class="pre">optional</span></tt> and the first package name are allowed.  Therefore,
you should not write <tt class="docutils literal"><span class="pre">optional:</span> <span class="pre">needs</span> <span class="pre">package</span> <span class="pre">CHomP</span></tt> but simply
<tt class="docutils literal"><span class="pre">optional:</span> <span class="pre">CHomP</span></tt>.</li>
<li>Optional tags are case-insensitive, so you could also write <tt class="docutils literal"><span class="pre">optional:</span>
<span class="pre">chOMP</span></tt>.</li>
</ul>
</div>
</li>
<li><p class="first"><strong>indirect doctest:</strong> in the docstring of a function <tt class="docutils literal"><span class="pre">A(...)</span></tt>, a line
calling <tt class="docutils literal"><span class="pre">A</span></tt> and in which the name <tt class="docutils literal"><span class="pre">A</span></tt> does not appear should have this
flag. This prevents <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">--coverage</span> <span class="pre">&lt;file&gt;</span></tt> from reporting the docstring as
&#8220;not testing what it should test&#8221;.</p>
<p>Use it when testing special functions like <tt class="docutils literal"><span class="pre">__repr__</span></tt>, <tt class="docutils literal"><span class="pre">__add__</span></tt>,
etc. Use it also when you test the function by calling <tt class="docutils literal"><span class="pre">B</span></tt> which
internally calls <tt class="docutils literal"><span class="pre">A</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre>This is the docstring of an ``__add__`` method. The following
example tests it, but ``__add__`` is not written anywhere::

    sage: 1+1 # indirect doctest
    2
</pre></div>
</div>
</li>
<li><p class="first"><strong>32-bit</strong> or <strong>64-bit:</strong> for tests that behave differently on 32-bit or
64-bit machines. Note that this particular flag is to be applied on the
<strong>output</strong> lines, not the input lines:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">sage: </span><span class="nb">hash</span><span class="p">(</span><span class="o">-</span><span class="mi">920390823904823094890238490238484</span><span class="p">)</span>
<span class="go">-873977844            # 32-bit</span>
<span class="go">6874330978542788722   # 64-bit</span>
</pre></div>
</div>
</li>
</ul>
<p>Using <tt class="docutils literal"><span class="pre">search_src</span></tt> from the Sage prompt (or <tt class="docutils literal"><span class="pre">grep</span></tt>), one can
easily find the aforementioned keywords. In the case of <tt class="docutils literal"><span class="pre">todo:</span> <span class="pre">not</span>
<span class="pre">implemented</span></tt>, one can use the results of such a search to direct
further development on Sage.</p>
</div>
</div>
<div class="section" id="running-automated-tests">
<span id="chapter-testing"></span><h2>Running Automated Tests<a class="headerlink" href="#running-automated-tests" title="Permalink to this headline">¶</a></h2>
<p>This section describes Sage&#8217;s automated testing of test files of the
following types: <tt class="docutils literal"><span class="pre">.py</span></tt>, <tt class="docutils literal"><span class="pre">.pyx</span></tt>, <tt class="docutils literal"><span class="pre">.sage</span></tt>, <tt class="docutils literal"><span class="pre">.rst</span></tt>. Briefly, use
<tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">&lt;file&gt;</span></tt> to test that the examples in <tt class="docutils literal"><span class="pre">&lt;file&gt;</span></tt> behave
exactly as claimed. See the following subsections for more
details. See also <a class="reference internal" href="#section-docstrings"><em>Documentation Strings</em></a> for a discussion on how to
include examples in documentation strings and what conventions to
follow. The chapter <a class="reference internal" href="doctesting.html#chapter-doctesting"><em>Running Sage&#8217;s doctests</em></a> contains a tutorial on
doctesting modules in the Sage library.</p>
<div class="section" id="testing-py-pyx-and-sage-files">
<span id="section-testpython"></span><h3>Testing .py, .pyx and .sage Files<a class="headerlink" href="#testing-py-pyx-and-sage-files" title="Permalink to this headline">¶</a></h3>
<p>Run <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">&lt;filename.py&gt;</span></tt> to test all code examples in
<tt class="docutils literal"><span class="pre">filename.py</span></tt>. Similar remarks apply to <tt class="docutils literal"><span class="pre">.sage</span></tt> and <tt class="docutils literal"><span class="pre">.pyx</span></tt>
files:</p>
<div class="highlight-python"><div class="highlight"><pre>sage -t [--verbose] [--optional]  [files and directories ... ]
</pre></div>
</div>
<p>The Sage doctesting framework is based on the standard Python doctest
module, but with many additional features (such as parallel testing,
timeouts, optional tests).  The Sage doctester recognizes <tt class="docutils literal"><span class="pre">sage:</span></tt>
prompts as well as <tt class="docutils literal"><span class="pre">&gt;&gt;&gt;</span></tt> prompts.  It also preparses the doctests,
just like in interactive Sage sessions.</p>
<p>Your file passes the tests if the code in it will run when entered
at the <tt class="docutils literal"><span class="pre">sage:</span></tt> prompt with no extra imports. Thus users are
guaranteed to be able to exactly copy code out of the examples you
write for the documentation and have them work.</p>
<p>For more information, see <a class="reference internal" href="doctesting.html#chapter-doctesting"><em>Running Sage&#8217;s doctests</em></a>.</p>
</div>
<div class="section" id="testing-rest-documentation">
<h3>Testing ReST Documentation<a class="headerlink" href="#testing-rest-documentation" title="Permalink to this headline">¶</a></h3>
<p>Run <tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span> <span class="pre">&lt;filename.rst&gt;</span></tt> to test the examples in verbatim
environments in ReST documentation.</p>
<p>Of course in ReST files, one often inserts explanatory texts between
different verbatim environments. To link together verbatim
environments, use the <tt class="docutils literal"><span class="pre">..</span> <span class="pre">link</span></tt> comment. For example:</p>
<div class="highlight-python"><div class="highlight"><pre>EXAMPLES::

        sage: a = 1


Next we add 1 to ``a``.

.. link::

        sage: 1 + a
        2
</pre></div>
</div>
<p>If you want to link all the verbatim environments together, you can
put <tt class="docutils literal"><span class="pre">..</span> <span class="pre">linkall</span></tt> anywhere in the file, on a line by itself.  (For
clarity, it might be best to put it near the top of the file.)  Then
<tt class="docutils literal"><span class="pre">sage</span> <span class="pre">-t</span></tt> will act as if there were a <tt class="docutils literal"><span class="pre">..</span> <span class="pre">link</span></tt> before each
verbatim environment.  The file
<tt class="docutils literal"><span class="pre">SAGE_ROOT/src/doc/en/tutorial/interfaces.rst</span></tt> contains a
<tt class="docutils literal"><span class="pre">..</span> <span class="pre">linkall</span></tt> directive, for example.</p>
<p>You can also put <tt class="docutils literal"><span class="pre">..</span> <span class="pre">skip</span></tt> right before a verbatim environment to
have that example skipped when testing the file.  This goes in the
same place as the <tt class="docutils literal"><span class="pre">..</span> <span class="pre">link</span></tt> in the previous example.</p>
<p>See the files in <tt class="docutils literal"><span class="pre">SAGE_ROOT/src/doc/en/tutorial/</span></tt> for many
examples of how to include automated testing in ReST documentation for
Sage.</p>
</div>
</div>
<div class="section" id="the-pickle-jar">
<span id="chapter-picklejar"></span><h2>The Pickle Jar<a class="headerlink" href="#the-pickle-jar" title="Permalink to this headline">¶</a></h2>
<p>Sage maintains a pickle jar at
<tt class="docutils literal"><span class="pre">SAGE_ROOT/src/ext/pickle_jar/pickle_jar.tar.bz2</span></tt> which is a tar
file of &#8220;standard&#8221; pickles created by <tt class="docutils literal"><span class="pre">sage</span></tt>. This pickle jar is
used to ensure that sage maintains backward compatibility by have
having <a class="reference external" href="../reference/structure/sage/structure/sage_object.html#sage.structure.sage_object.unpickle_all" title="(in Sage Reference Manual: Basic Structures v6.8)"><tt class="xref py py-func docutils literal"><span class="pre">sage.structure.sage_object.unpickle_all()</span></tt></a> check that
<tt class="docutils literal"><span class="pre">sage</span></tt> can always unpickle all of the pickles in the pickle jar as
part of the standard doc testing framework.</p>
<p>Most people first become aware of the pickle_jar when their patch breaks the
unpickling of one of the &#8220;standard&#8221; pickles in the pickle jar due to the
failure of the doctest:</p>
<div class="highlight-python"><div class="highlight"><pre>sage -t src/sage/structure/sage_object.pyx
</pre></div>
</div>
<p>When this happens an error message is printed which contains the following
hints for fixing the uneatable pickle:</p>
<div class="highlight-python"><div class="highlight"><pre>----------------------------------------------------------------------
** This error is probably due to an old pickle failing to unpickle.
** See sage.structure.sage_object.register_unpickle_override for
** how to override the default unpickling methods for (old) pickles.
** NOTE: pickles should never be removed from the pickle_jar!
----------------------------------------------------------------------
</pre></div>
</div>
<p>For more details about how to fix unpickling errors in the pickle jar
see <a class="reference external" href="../reference/structure/sage/structure/sage_object.html#sage.structure.sage_object.register_unpickle_override" title="(in Sage Reference Manual: Basic Structures v6.8)"><tt class="xref py py-func docutils literal"><span class="pre">sage.structure.sage_object.register_unpickle_override()</span></tt></a></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Sage&#8217;s pickle jar helps to ensure backward compatibility in sage. Pickles should
<strong>only</strong> be removed from the pickle jar after the corresponding objects
have been properly deprecated. Any proposal to remove pickles from the
pickle jar should first be discussed on sage-devel.</p>
</div>
</div>
<div class="section" id="global-options">
<h2>Global Options<a class="headerlink" href="#global-options" title="Permalink to this headline">¶</a></h2>
<p>Global options for classes can be defined in Sage using
<a class="reference external" href="../reference/structure/sage/structure/global_options.html#sage.structure.global_options.GlobalOptions" title="(in Sage Reference Manual: Basic Structures v6.8)"><tt class="xref py py-class docutils literal"><span class="pre">GlobalOptions</span></tt></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">General Conventions</a><ul>
<li><a class="reference internal" href="#python-code-style">Python Code Style</a></li>
<li><a class="reference internal" href="#files-and-directory-structure">Files and Directory Structure</a></li>
<li><a class="reference internal" href="#learn-by-copy-paste">Learn by copy/paste</a></li>
<li><a class="reference internal" href="#headings-of-sage-library-code-files">Headings of Sage Library Code Files</a></li>
<li><a class="reference internal" href="#documentation-strings">Documentation Strings</a><ul>
<li><a class="reference internal" href="#the-docstring-of-a-function-content">The docstring of a function: content</a><ul>
<li><a class="reference internal" href="#template">Template</a></li>
<li><a class="reference internal" href="#private-functions">Private functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#latex-typesetting">LaTeX Typesetting</a></li>
<li><a class="reference internal" href="#writing-testable-examples">Writing Testable Examples</a></li>
<li><a class="reference internal" href="#special-markup-to-influence-tests">Special Markup to Influence Tests</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-automated-tests">Running Automated Tests</a><ul>
<li><a class="reference internal" href="#testing-py-pyx-and-sage-files">Testing .py, .pyx and .sage Files</a></li>
<li><a class="reference internal" href="#testing-rest-documentation">Testing ReST Documentation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-pickle-jar">The Pickle Jar</a></li>
<li><a class="reference internal" href="#global-options">Global Options</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="trac.html"
                                  title="previous chapter">The Sage Trac Server</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="reviewer_checklist.html"
                                  title="next chapter">The reviewer&#8217;s check list</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/coding_basics.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <!-- The shading of the "Go" button should be consistent -->
                <!-- with the colour of the header and footer. See the file -->
                <!-- doc/common/themes/sage/theme.conf for colours used by -->
                <!-- the Sage theme. -->
                <input type="submit" style="background-color: #B8B9F6" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="reviewer_checklist.html" title="The reviewer’s check list"
             >next</a> |</li>
        <li class="right" >
          <a href="trac.html" title="The Sage Trac Server"
             >previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v6.8</a> &raquo;</li>
 
      </ul>
    </div>
    
    <div class="footer">
        &copy; Copyright 2005--2015, The Sage Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
  </body>
</html>