<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Collaborative Development with Git-Trac &mdash; Sage Developer&#39;s Guide v6.6</title>
    
    <link rel="stylesheet" href="_static/sage.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '6.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <script type="text/javascript" src="_static/MathJax.js?config=TeX-AMS_HTML-full,../mathjax_sage.js"></script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="top" title="Sage Developer&#39;s Guide v6.6" href="index.html" />
    <link rel="next" title="Git the Hard Way" href="manual_git.html" />
    <link rel="prev" title="Sage Development Process" href="walk_through.html" />
    <link rel="icon" href="_static/sageicon.png" type="image/x-icon" />

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="manual_git.html" title="Git the Hard Way"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="walk_through.html" title="Sage Development Process"
             accesskey="P">previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v6.6</a> &raquo;</li>
 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="collaborative-development-with-git-trac">
<span id="chapter-git-trac"></span><h1>Collaborative Development with Git-Trac<a class="headerlink" href="#collaborative-development-with-git-trac" title="Permalink to this headline">¶</a></h1>
<p>Sometimes you will only want to work on local changes to Sage, for
your own private needs.  However, typically it is beneficial to
share code and ideas with others; the manner in which the
<a class="reference external" href="http://sagemath.org">Sage project</a> does this (as well as fixing
bugs and upgrading components) is in a very collaborative and
public setting on <a class="reference external" href="http://trac.sagemath.org">the Sage Trac server</a>
(the Sage bug and enhancement tracker).</p>
<p>One can use <tt class="docutils literal"><span class="pre">git</span></tt> <a class="reference internal" href="manual_git.html#chapter-manual-git"><em>the hard way</em></a> for this,
but this section explains how to use the helper <tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span></tt> command, which
simplifies many of the most common actions in collaboration on Sage.</p>
<p>Most of the commands in the following section will not work unless
you have an account on Trac. If you want to contribute to Sage, it
is a good idea to get an account now (see <a class="reference internal" href="trac.html#section-trac-account"><em>Obtaining an Account</em></a>).</p>
<div class="section" id="installing-the-git-trac-command">
<span id="section-git-trac-install"></span><h2>Installing the Git-Trac Command<a class="headerlink" href="#installing-the-git-trac-command" title="Permalink to this headline">¶</a></h2>
<p>Git is a separate project from trac, and the two do not know how to
talk to each other. To simplify the development, we have a special
<tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span></tt> subcommand for the git suite. Note that this really is
only to simplify interaction with our trac issue management, you can
perform every development task with just git and a web browser. See
<a class="reference internal" href="manual_git.html#chapter-manual-git"><em>Git the Hard Way</em></a> instead if you prefer to do everything by
hand:</p>
<div class="highlight-python"><div class="highlight"><pre>[user@localhost]$ git clone https://github.com/sagemath/git-trac-command.git
Cloning into &#39;git-trac-command&#39;...
[...]
Checking connectivity... done.
[user@localhost]$ source git-trac-command/enable.sh
Prepending the git-trac command to your search PATH
</pre></div>
</div>
<p>This creates a directory <tt class="docutils literal"><span class="pre">git-trac-command</span></tt>.</p>
<p>Sourcing the <tt class="docutils literal"><span class="pre">enable.sh</span></tt> script in there is just a quick and dirty
way to enable it temporarily. For a more permanent installation on
your system later, make sure to put the <tt class="docutils literal"><span class="pre">git-trac</span></tt> command in your
<tt class="docutils literal"><span class="pre">PATH</span></tt>. Assuming that <tt class="docutils literal"><span class="pre">~/bin</span></tt> is already in your <tt class="docutils literal"><span class="pre">PATH</span></tt>, you can
do this by symlinking:</p>
<div class="highlight-python"><div class="highlight"><pre>[user@localhost]$ echo $PATH
/home/user/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/sbin:/usr/sbin
[user@localhost]$ cd git-trac-command
[user@localhost git-trac-command]$ ln -s `pwd`/git-trac ~/bin/
</pre></div>
</div>
<p>See the <a class="reference external" href="https://github.com/sagemath/git-trac-command">git-trac README</a> for
more details.</p>
</div>
<div class="section" id="git-and-trac-configuration">
<span id="section-git-trac-setup"></span><h2>Git and Trac Configuration<a class="headerlink" href="#git-and-trac-configuration" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<ul class="last simple">
<li><a class="reference external" href="http://trac.sagemath.org">trac</a> uses username/password for
authentication.</li>
<li>Our <a class="reference external" href="http://git.sagemath.org">git repository server</a> uses SSH
public key authentication for write access.</li>
</ul>
</div>
<p>You need to set up both authentication mechanisms to be able to upload
your changes with &#8220;git trac&#8221;. For read-only access neither
authentication mechanism is needed. To set up <tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span></tt>, first go
to the Sage directory and tell <tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span></tt> about your trac account:</p>
<div class="highlight-python"><div class="highlight"><pre>[user@localhost sage]$ git trac config --user USERNAME --pass &#39;PASSWORD&#39;
Trac xmlrpc URL:
    http://trac.sagemath.org/xmlrpc (anonymous)
    http://trac.sagemath.org/login/xmlrpc (authenticated)
    realm sage.math.washington.edu
Username: USERNAME
Password: PASSWORD
Retrieving SSH keys...
    1024 ab:1b:7c:c9:9b:48:fe:dd:59:56:1e:9d:a4:a6:51:9d  My SSH Key
</pre></div>
</div>
<p>where you have to replace USERNAME with your trac user name and
PASSWORD with your trac password. If you don&#8217;t have a trac account,
use <tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span> <span class="pre">config</span></tt> without any arguments. The single quotes in
<tt class="docutils literal"><span class="pre">'PASSWORD'</span></tt> escape special characters that you might have in your
password. The password is stored in plain-text in <tt class="docutils literal"><span class="pre">.git/config</span></tt>, so
make sure that it is not readable by other users on your system. For
example, by running <tt class="docutils literal"><span class="pre">chmod</span> <span class="pre">0600</span> <span class="pre">.git/config</span></tt> if your home directory
is not already private.</p>
<p>If there is no SSH key listed then you haven&#8217;t uploaded your SSH
public key to the trac server. You should do that now following the
instructions to <a class="reference internal" href="trac.html#section-trac-ssh-key"><em>Manually Linking your Public Key to your Trac Account</em></a>, if you want to upload
any changes.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span> <span class="pre">config</span></tt> command will automatically add a <tt class="docutils literal"><span class="pre">trac</span></tt>
remote git repository to your list of remotes if necessary.</p>
</div>
<p>If you followed the above instructions then you will have two remote
repositories set up:</p>
<div class="highlight-python"><div class="highlight"><pre>[user@localhost sage]$ git remote -v
origin      git://github.com/sagemath/sage.git (fetch)
origin      git://github.com/sagemath/sage.git (push)
trac        git://trac.sagemath.org/sage.git (fetch)
trac        git@trac.sagemath.org:sage.git (push)
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">git&#64;...</span></tt> part of the push url means that write access is
secured with SSH keys, which you must have set up as in
<a class="reference internal" href="trac.html#section-trac-ssh-key"><em>Manually Linking your Public Key to your Trac Account</em></a>. Read-only access happens through the
fetch url and does not require SSH.</p>
<p>Finally, if you do not want to use the <tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span></tt> subcommand at all
then you can set up the remote by hand as described in the section on
<a class="reference internal" href="manual_git.html#section-git-trac"><em>The Trac Server</em></a>.</p>
</div>
<div class="section" id="trac-tickets-and-git-branches">
<h2>Trac Tickets and Git Branches<a class="headerlink" href="#trac-tickets-and-git-branches" title="Permalink to this headline">¶</a></h2>
<p>Now let&#8217;s start adding code to Sage!</p>
<div class="section" id="create-a-ticket">
<span id="section-git-trac-create"></span><h3>Create a Ticket<a class="headerlink" href="#create-a-ticket" title="Permalink to this headline">¶</a></h3>
<p>Suppose you have written an algorithm for calculating the last twin prime, and
want to add it to Sage. You would first open a ticket for that:</p>
<div class="highlight-python"><div class="highlight"><pre>[user@localhost sage]$ git trac create &#39;Last Twin Prime&#39;
Remote branch: u/user/last_twin_prime
Newly-created ticket number: 12345
Ticket URL: http://trac.sagemath.org/12345
Local branch: t/12345/last_twin_prime
</pre></div>
</div>
<p>This will create a new trac ticket titled &#8220;Last Twin Prime&#8221; with a
<em>remote branch</em> <tt class="docutils literal"><span class="pre">u/user/last_twin_prime</span></tt> attached to it. The remote
branch name is automatically derived from the ticket title; If you
don&#8217;t like this then you can use the <tt class="docutils literal"><span class="pre">-b</span></tt> switch to specify it
explicitly. See <tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span> <span class="pre">create</span> <span class="pre">-h</span></tt> for details. This new branch is
automatically checked out for you with the <em>local branch</em> name
<tt class="docutils literal"><span class="pre">t/12345/last_twin_prime</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only some trac fields are filled in automatically. See
<a class="reference internal" href="trac.html#section-trac-fields"><em>The Ticket Fields</em></a> for what trac fields are available and
how we use them.</p>
</div>
</div>
<div class="section" id="check-out-an-existing-ticket">
<span id="section-git-trac-checkout"></span><h3>Check out an Existing Ticket<a class="headerlink" href="#check-out-an-existing-ticket" title="Permalink to this headline">¶</a></h3>
<p>Alternatively, you can use the <a class="reference external" href="http://trac.sagemath.org">web interface to the Sage trac
development server</a> to open a new ticket.
Just log in and click on &#8220;Create Ticket&#8221;.</p>
<p>Or maybe somebody else already opened a ticket. Then, to get a suitable
local branch to make your edits, you would just run:</p>
<div class="highlight-python"><div class="highlight"><pre>[user@localhost sage]$ git trac checkout 12345
Loading ticket #12345...
Checking out Trac #13744 remote branch u/user/last_twin_prime -&gt; local branch t/12345/last_twin_prime...
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span> <span class="pre">checkout</span></tt> command downloads an existing branch (as
specified in the &#8220;Branch:&#8221; field on the trac ticket) or creates a new
one if there is none yet. Just like the create command, you can
specify the remote branch name explicitly using the <tt class="docutils literal"><span class="pre">-b</span></tt> switch if
you want.</p>
</div>
<div class="section" id="note-on-branch-names">
<span id="section-git-trac-branch-names"></span><h3>Note on Branch Names<a class="headerlink" href="#note-on-branch-names" title="Permalink to this headline">¶</a></h3>
<p>The &#8220;Branch:&#8221; field of a trac ticket (see <a class="reference internal" href="trac.html#section-trac-fields"><em>The Ticket Fields</em></a>) indicates
the git branch containing its code. Our git server implements the following
access restrictions for <strong>remote branch names</strong>:</p>
<ul class="simple">
<li>You can read/write/create a branch named
<tt class="docutils literal"><span class="pre">u/your_username/whatever_you_like</span></tt>. Everybody else can read.</li>
<li>Everybody can read/write/create a branch named <tt class="docutils literal"><span class="pre">public/whatever_you_like</span></tt>.</li>
</ul>
<p>Depending on your style of collaboration, you can use one or the
other. The <tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span></tt> subcommands defaults to the former.</p>
<p>As a convention, the <tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span></tt> subcommand uses <strong>local branch
names</strong> of the form <tt class="docutils literal"><span class="pre">t/12345/description</span></tt>, where the number is the
trac ticket number. The script uses this number to figure out the
ticket from the local branch name. You can rename the local branches
if you want, but if they don&#8217;t contain the ticket number then you will
have to specify the ticket number manually when you are uploading your
changes.</p>
</div>
</div>
<div class="section" id="uploading-changes-to-trac">
<span id="section-git-trac-push"></span><h2>Uploading Changes to Trac<a class="headerlink" href="#uploading-changes-to-trac" title="Permalink to this headline">¶</a></h2>
<div class="section" id="automatic-push">
<span id="section-git-trac-push-auto"></span><h3>Automatic Push<a class="headerlink" href="#automatic-push" title="Permalink to this headline">¶</a></h3>
<p>At some point, you may wish to share your changes with the rest of us:
maybe it is ready for review, or maybe you are collaborating with
someone and want to share your changes &#8220;up until now&#8221;. This is simply
done by:</p>
<div class="highlight-python"><div class="highlight"><pre>[user@localhost sage]$ git trac push
Pushing to Trac #12345...
Guessed remote branch: u/user/last_twin_prime

To git@trac.sagemath.org:sage.git
 * [new branch]      HEAD -&gt; u/user/last_twin_prime

Changing the trac &quot;Branch:&quot; field...
</pre></div>
</div>
<p>This uploads your changes to a remote branch on the <a class="reference external" href="http://git.sagemath.org/sage.git">Sage git server</a>. The <tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span></tt> command uses
the following logic to find out the remote branch name:</p>
<ul class="simple">
<li>By default, the remote branch name will be whatever is already on
the trac ticket.</li>
<li>If there is no remote branch yet, the branch will be called
<tt class="docutils literal"><span class="pre">u/user/description</span></tt> (<tt class="docutils literal"><span class="pre">u/user/last_twin_prime</span></tt> in the example).</li>
<li>You can use the <tt class="docutils literal"><span class="pre">--branch</span></tt> option to specify the remote branch
name explicitly, but it needs to follow the naming convention from
<a class="reference internal" href="#section-git-trac-branch-names"><em>Note on Branch Names</em></a> for you to have write
permission.</li>
</ul>
</div>
<div class="section" id="specifying-the-ticket-number">
<span id="section-git-trac-push-with-ticket-number"></span><h3>Specifying the Ticket Number<a class="headerlink" href="#specifying-the-ticket-number" title="Permalink to this headline">¶</a></h3>
<p>You can upload any local branch to an existing ticket, whether or not
you created the local branch with <tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span></tt>. This works exactly
like in the case where you started with a ticket, except that you have
to specify the ticket number (since there is no way to tell which
ticket you have in mind). That is:</p>
<div class="highlight-python"><div class="highlight"><pre>[user@localhost sage]$ git trac push TICKETNUM
</pre></div>
</div>
<p>where you have to replace <tt class="docutils literal"><span class="pre">TICKETNUM</span></tt> with the number of the trac
ticket.</p>
</div>
<div class="section" id="finishing-it-up">
<span id="section-git-trac-push-finish"></span><h3>Finishing It Up<a class="headerlink" href="#finishing-it-up" title="Permalink to this headline">¶</a></h3>
<p>It is common to go through a few iterations of commits before you
upload, and you will probably also have pushed your changes a few
times before your changes are ready for review.</p>
<p>Once you are happy with the changes you uploaded, they must be
reviewed by somebody else before they can be included in the next
version of Sage. To mark your ticket as ready for review, you should
set it to <tt class="docutils literal"><span class="pre">needs_review</span></tt> on the trac server. Also, add yourself as
the (or one of the) author(s) for that ticket by inserting the
following as the first line:</p>
<div class="highlight-python"><div class="highlight"><pre>Authors: Your Real Name
</pre></div>
</div>
</div>
</div>
<div class="section" id="downloading-changes-from-trac">
<span id="section-git-trac-pull"></span><h2>Downloading Changes from Trac<a class="headerlink" href="#downloading-changes-from-trac" title="Permalink to this headline">¶</a></h2>
<p>If somebody else worked on a ticket, or if you just switched
computers, you&#8217;ll want to get the latest version of the branch from a
ticket into your local branch. This is done with:</p>
<div class="highlight-python"><div class="highlight"><pre>[user@localhost sage]$ git trac pull
</pre></div>
</div>
<p>Technically, this does a <em>merge</em> (just like the standard <tt class="docutils literal"><span class="pre">git</span> <span class="pre">pull</span></tt>)
command. See <a class="reference internal" href="manual_git.html#section-git-merge"><em>Merging and Rebasing</em></a> for more background information.</p>
</div>
<div class="section" id="merging">
<span id="section-git-trac-merge"></span><h2>Merging<a class="headerlink" href="#merging" title="Permalink to this headline">¶</a></h2>
<p>As soon as you are working on a bigger project that spans multiple
tickets you will want to base your work on branches that have not been
merged into Sage yet. This is natural in collaborative development,
and in fact you are very much encouraged to split your work into
logically different parts. Ideally, each part that is useful on its
own and can be reviewed independently should be a different ticket
instead of a huge patch bomb.</p>
<p>For this purpose, you can incorporate branches from other tickets (or
just other local branches) into your current branch. This is called
merging, and all it does is include commits from other branches into
your current branch. In particular, this is done when a new Sage
release is made: the finished tickets are merged with the Sage master
and the result is the next Sage version. Git is smart enough to not
merge commits twice. In particular, it is possible to merge two
branches, one of which had already merged the other branch. The syntax
for merging is easy:</p>
<div class="highlight-python"><div class="highlight"><pre>[user@localhost sage]$ git merge other_branch
</pre></div>
</div>
<p>This creates a new &#8220;merge&#8221; commit, joining your current branch and
<tt class="docutils literal"><span class="pre">other_branch</span></tt>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>You should avoid merging branches both ways. Once A merged B and B
merged A, there is no way to distinguish commits that were
originally made in A or B. Effectively, merging both ways combines
the branches and makes individual review impossible.</p>
<p>In practice, you should only merge when one of the following holds:</p>
<ul class="last simple">
<li>Either two tickets conflict, then you have to merge one into the
other in order to resolve the merge conflict.</li>
<li>Or you definitely need a feature that has been developed as part
of another branch.</li>
</ul>
</div>
<p>A special case of merging is merging in the <tt class="docutils literal"><span class="pre">master</span></tt> branch. This
brings your local branch up to date with the newest Sage version. The
above warning against unnecessary merges still applies, though. Try to
do all of your development with the Sage version that you originally
started with. The only reason for merging in the master branch is if
you need a new feature or if your branch conflicts.</p>
</div>
<div class="section" id="collaboration-and-conflict-resolution">
<span id="section-git-trac-collaborate"></span><h2>Collaboration and conflict resolution<a class="headerlink" href="#collaboration-and-conflict-resolution" title="Permalink to this headline">¶</a></h2>
<div class="section" id="exchanging-branches">
<h3>Exchanging Branches<a class="headerlink" href="#exchanging-branches" title="Permalink to this headline">¶</a></h3>
<p>It is very easy to collaborate by just going through the above steps
any number of times. For example, Alice starts a ticket and adds some
initial code:</p>
<div class="highlight-python"><div class="highlight"><pre>[alice@laptop sage]$ git trac create &quot;A and B Ticket&quot;
... EDIT EDIT ...
[alice@laptop sage]$ git add .
[alice@laptop sage]$ git commit
[alice@laptop sage]$ git trac push
</pre></div>
</div>
<p>The trac ticket now has &#8220;Branch:&#8221; set to
<tt class="docutils literal"><span class="pre">u/alice/a_and_b_ticket</span></tt>. Bob downloads the branch and works some
more on it:</p>
<div class="highlight-python"><div class="highlight"><pre>[bob@home sage]$ git trac checkout TICKET_NUMBER
... EDIT EDIT ...
[bob@home sage]$ git add .
[bob@home sage]$ git commit
[bob@home sage]$ git trac push
</pre></div>
</div>
<p>The trac ticket now has &#8220;Branch:&#8221; set to <tt class="docutils literal"><span class="pre">u/bob/a_and_b_ticket</span></tt>,
since Bob cannot write to <tt class="docutils literal"><span class="pre">u/alice/...</span></tt>. Now the two authors just
pull/push in their collaboration:</p>
<div class="highlight-python"><div class="highlight"><pre>[alice@laptop sage]$ git trac pull
... EDIT EDIT ...
[alice@laptop sage]$ git add .
[alice@laptop sage]$ git commit
[alice@laptop sage]$ git trac push

[bob@home sage]$ git trac pull
... EDIT EDIT ...
[bob@home sage]$ git add .
[bob@home sage]$ git commit
[bob@home sage]$ git trac push
</pre></div>
</div>
<p>Alice and Bob need not alternate, they can also add further commits on
top of their own remote branch.  As long as their changes do not
conflict (edit the same lines simultaneously), this is fine.</p>
</div>
<div class="section" id="conflict-resolution">
<span id="section-git-trac-conflict"></span><h3>Conflict Resolution<a class="headerlink" href="#conflict-resolution" title="Permalink to this headline">¶</a></h3>
<p>Merge conflicts happen if there are overlapping edits, and they are an
unavoidable consequence of distributed development. Fortunately,
resolving them is common and easy with git. As a hypothetical example,
consider the following code snippet:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the `i`-th Fibonacci number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>This is clearly wrong; Two developers, namely Alice and Bob, decide to
fix it. First, in a cabin in the woods far away from any internet
connection, Alice corrects the seed values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   Return the `i`-th Fibonacci number</span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
       <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
   <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
<p>and turns those changes into a new commit:</p>
<div class="highlight-python"><div class="highlight"><pre>[alice@laptop sage]$ git add fibonacci.py
[alice@laptop sage]$ git commit -m &#39;return correct seed values&#39;
</pre></div>
</div>
<p>However, not having an internet connection, she cannot immediately
send her changes to the trac server. Meanwhile, Bob changes the
multiplication to an addition since that is the correct recursion
formula:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the `i`-th Fibonacci number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>and immediately uploads his change:</p>
<div class="highlight-python"><div class="highlight"><pre>[bob@home sage]$ git add fibonacci.py
[bob@home sage]$ git commit -m &#39;corrected recursion formula, must be + instead of *&#39;
[bob@home sage]$ git trac push
</pre></div>
</div>
<p>Eventually, Alice returns to civilization. In her mailbox, she finds a
trac notification email that Bob has uploaded further changes to their
joint project. Hence, she starts out by getting his changes into her
own local branch:</p>
<div class="highlight-python"><div class="highlight"><pre>[alice@laptop sage]$ git trac pull
...
CONFLICT (content): Merge conflict in fibonacci.py
Automatic merge failed; fix conflicts and then commit the result.
</pre></div>
</div>
<p>The file now looks like this:</p>
<div class="highlight-python"><div class="highlight"><pre>def fibonacci(i):
    &quot;&quot;&quot;
    Return the `i`-th Fibonacci number
    &quot;&quot;&quot;
&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
    if i &gt; 1:
        return fibonacci(i-1) * fibonacci(i-2)
    return i
=======
    return fibonacci(i-1) + fibonacci(i-2)
&gt;&gt;&gt;&gt;&gt;&gt;&gt; 41675dfaedbfb89dcff0a47e520be4aa2b6c5d1b
</pre></div>
</div>
<p>The conflict is shown between the conflict markers <tt class="docutils literal"><span class="pre">&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span></tt> and
<tt class="docutils literal"><span class="pre">&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span></tt>. The first half (up to the <tt class="docutils literal"><span class="pre">=======</span></tt> marker) is Alice&#8217;s
current version, the second half is Bob&#8217;s version. The 40-digit hex
number after the second conflict marker is the SHA1 hash of the most
recent common parent of both.</p>
<p>It is now Alice&#8217;s job to resolve the conflict by reconciling their
changes, for example by editing the file. Her result is:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the `i`-th Fibonacci number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fibonacci</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
<p>And then upload both her original change <em>and</em> her merge commit to trac:</p>
<div class="highlight-python"><div class="highlight"><pre>[alice@laptop sage]$ git add fibonacci.py
[alice@laptop sage]$ git commit -m &quot;merged Bob&#39;s changes with mine&quot;
</pre></div>
</div>
<p>The resulting commit graph now has a loop:</p>
<div class="highlight-python"><div class="highlight"><pre>[alice@laptop sage]$ git log --graph --oneline
*   6316447 merged Bob&#39;s changes with mine
|\
| * 41675df corrected recursion formula, must be + instead of *
* | 14ae1d3 return correct seed values
|/
* 14afe53 initial commit
</pre></div>
</div>
<p>If Bob decides to do further work on the ticket then he will have to
pull Alice&#8217;s changes. However, this time there is no conflict on his
end: git downloads both Alice&#8217;s conflicting commit and her resolution.</p>
</div>
</div>
<div class="section" id="reviewing">
<span id="section-git-trac-review"></span><h2>Reviewing<a class="headerlink" href="#reviewing" title="Permalink to this headline">¶</a></h2>
<p>This section gives an example how to review using the <tt class="docutils literal"><span class="pre">sage</span></tt> command. For an
explanation of what should be checked by the reviewer, see
<a class="reference internal" href="reviewer_checklist.html#chapter-review"><em>The reviewer&#8217;s check list</em></a>.</p>
<p>If you go to the <a class="reference external" href="http://trac.sagemath.org">web interface to the Sage trac development server</a> then you can click on the &#8220;Branch:&#8221; field and see
the code that is added by combining all commits of the ticket. This is what
needs to be reviewed.</p>
<p>The <tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span></tt> command gives you two commands that might be handy
(replace <tt class="docutils literal"><span class="pre">12345</span></tt> with the actual ticket number) if you do not want
to use the web interface:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span> <span class="pre">print</span> <span class="pre">12345</span></tt> displays the trac ticket directly in your
terminal.</li>
<li><tt class="docutils literal"><span class="pre">git</span> <span class="pre">trac</span> <span class="pre">review</span> <span class="pre">12345</span></tt> downloads the branch from the ticket and
shows you what is being added, analogous to clicking on the
&#8220;Branch:&#8221; field.</li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference internal" href="#">Collaborative Development with Git-Trac</a><ul>
<li><a class="reference internal" href="#installing-the-git-trac-command">Installing the Git-Trac Command</a></li>
<li><a class="reference internal" href="#git-and-trac-configuration">Git and Trac Configuration</a></li>
<li><a class="reference internal" href="#trac-tickets-and-git-branches">Trac Tickets and Git Branches</a><ul>
<li><a class="reference internal" href="#create-a-ticket">Create a Ticket</a></li>
<li><a class="reference internal" href="#check-out-an-existing-ticket">Check out an Existing Ticket</a></li>
<li><a class="reference internal" href="#note-on-branch-names">Note on Branch Names</a></li>
</ul>
</li>
<li><a class="reference internal" href="#uploading-changes-to-trac">Uploading Changes to Trac</a><ul>
<li><a class="reference internal" href="#automatic-push">Automatic Push</a></li>
<li><a class="reference internal" href="#specifying-the-ticket-number">Specifying the Ticket Number</a></li>
<li><a class="reference internal" href="#finishing-it-up">Finishing It Up</a></li>
</ul>
</li>
<li><a class="reference internal" href="#downloading-changes-from-trac">Downloading Changes from Trac</a></li>
<li><a class="reference internal" href="#merging">Merging</a></li>
<li><a class="reference internal" href="#collaboration-and-conflict-resolution">Collaboration and conflict resolution</a><ul>
<li><a class="reference internal" href="#exchanging-branches">Exchanging Branches</a></li>
<li><a class="reference internal" href="#conflict-resolution">Conflict Resolution</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reviewing">Reviewing</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="walk_through.html"
                                  title="previous chapter">Sage Development Process</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="manual_git.html"
                                  title="next chapter">Git the Hard Way</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/git_trac.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <!-- The shading of the "Go" button should be consistent -->
                <!-- with the colour of the header and footer. See the file -->
                <!-- doc/common/themes/sage/theme.conf for colours used by -->
                <!-- the Sage theme. -->
                <input type="submit" style="background-color: #B8B9F6" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="manual_git.html" title="Git the Hard Way"
             >next</a> |</li>
        <li class="right" >
          <a href="walk_through.html" title="Sage Development Process"
             >previous</a> |</li>
  
    
      <a href="../index.html"><img src="_static/sagelogo.png" style="vertical-align: middle" title="Sage Logo"></a>
    
  
  
        <li><a href="index.html">Developer&#39;s Guide v6.6</a> &raquo;</li>
 
      </ul>
    </div>
    
    <div class="footer">
        &copy; Copyright 2005--2015, The Sage Development Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
    <script type="text/javascript">
/*global jQuery, window */
/* Sphinx sidebar toggle.  Putting this code at the end of the body
 * enables the toggle for the live, static, and offline docs.  Note:
 * sage.misc.html.math_parse() eats jQuery's dollar-sign shortcut. */
var jq = jQuery;
jq(document).ready(function () {
    var bar, bod, bg, fg, key, tog, wid_old, wid_new, resize, get_state, set_state;
    bod = jq('div.bodywrapper');
    bar = jq('div.sphinxsidebar');
    tog = jq('<div class="sphinxsidebartoggle"></div>');

    /* Delayed resize helper.  Not perfect but good enough. */
    resize = function () {
        setTimeout(function () {
            tog.height(bod.height());
        }, 100);
    };
    jq(window).resize(function () {
        resize();
    });

    /* Setup and add the toggle. See Sphinx v0.5.1 default.css. */
    fg = jq('div.sphinxsidebar p a').css('color') || 'rgb(152, 219, 204)';
    bg = jq('div.document').css('background-color') || 'rgb(28, 78, 99)';
    wid_old = '230px';
    wid_new = '5px';
    tog.css('background-color', bg)
        .css('border-width', '0px')
        .css('border-right', wid_new + ' ridge ' + bg)
        .css('cursor', 'pointer')
        .css('position', 'absolute')
        .css('left', '-' + wid_new)
        .css('top', '0px')
        .css('width', wid_new);
    bod.css('position', 'relative');
    bod.prepend(tog);
    resize();

    /* Cookie helpers. */
    key = 'sphinxsidebar=';
    set_state = function (s) {
        var date = new Date();
        /* Expiry in 7 days. */
        date.setTime(date.getTime() + (7 * 24 * 3600 * 1000));
        document.cookie = key + encodeURIComponent(s) + '; expires=' +
            date.toUTCString() + '; path=/';
    };
    get_state = function () {
        var i, c, crumbs = document.cookie.split(';');
        for (i = 0; i < crumbs.length; i += 1) {
            c = crumbs[i].replace(/^\s+/, '');
            if (c.indexOf(key) === 0) {
                return decodeURIComponent(c.substring(key.length, c.length));
            }
        }
        return null;
    };

    /* Event handlers. */
    tog.mouseover(function (ev) {
        tog.css('border-right-color', fg);
    }).mouseout(function (ev) {
        tog.css('border-right-color', bg);
    }).click(function (ev) {
        if (bod.hasClass('wide')) {
            bod.removeClass('wide');
            bod.css('margin-left', wid_old);
            bar.css('width', wid_old);
            bar.show();
            set_state('visible');
        } else {
            set_state('hidden');
            bar.hide();
            bar.css('width', '0px');
            bod.css('margin-left', wid_new);
            bod.addClass('wide');
        }
        resize();
    });

    /* Hide the normally visible sidebar? */
    if (get_state() === 'hidden') {
        tog.trigger('click');
    } else {
        set_state('visible');
    }
});
    </script>
  </body>
</html>